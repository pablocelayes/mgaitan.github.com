<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="title" content="tin_nqn | &gt;&gt;&gt; me.geek.post()"><meta name="description" content="&gt;&gt;&gt; me.geek.post()"><meta name="author" content="Martín Gaitán"><title>tin_nqn | &gt;&gt;&gt; me.geek.post() </title><!-- Le styles --><link href="assets/css/bootstrap.css" rel="stylesheet" type="text/css"><link href="assets/css/bootstrap-responsive.css" rel="stylesheet" type="text/css"><link href="assets/css/rst.css" rel="stylesheet" type="text/css"><link href="assets/css/code.css" rel="stylesheet" type="text/css"><link href="assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="assets/css/theme.css" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic" rel="stylesheet" type="text/css"><link href="assets/css/custom.css" rel="stylesheet"><script src="assets/js/jquery-1.7.2.min.js" type="text/javascript"></script><script src="assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script src="assets/js/jquery.timeago.js" type="text/javascript"></script><script src="assets/js/jquery.timeago.es.js" type="text/javascript"></script><script>

            jQuery(document).ready(function() {
              jQuery("span.timeago").timeago();
            });

        </script><!-- Le HTML5 shim, for IE6-8 support of HTML5 elements --><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS (es)" href="rss.xml"></head><body>
<div class="container-fluid" id="container">
    <div class="row-fluid" id="titlerow">

    <div class="span10 offset1" id="titlecolumn">
    <!-- Banner-like substance !-->
        <div class="titlebox span3">
        <h1 id="blog-title">
            <a href=".">tin_nqn</a>
        </h1>
        <h6 id="blog-description">&gt;&gt;&gt; me.geek.post()</h6>

        
        
        
        </div>
    <div id="menu" class="span7 offset1">
      <ul class="inline"><li><a href="archive.html">Archivos</a>
                 / 
            
                </li><li><a href="categories/index.html">Categorías</a>
                 / 
            
                </li><li><a href="about.html">Sobre mí</a>
                 / 
            
                </li><li><a href="charlas.html">Charlas</a>
                
            
        </li></ul></div>
    <!-- End of banner-like substance !-->
    <div class="row" id="contentrow">
        <div class="span10 offset1" id="contentcolumn">
            <!--Body content-->
            
    
        <div class="postbox">
        <h1><a href="posts/hola-preciosa.html">Hola Preciosa</a>
        <small>  
             <span class="timeago" title="2013-06-02 20:54:17">2013-06-02 20:54:17</span>
        </small></h1>
        <!-- link: -->
<!-- description: -->
<!-- tags: preciosa, ideas -->
<!-- date: 2013/06/02 20:54:17 -->
<!-- title: Hola Preciosa -->
<!-- slug: hola-preciosa -->
<p>Mi <a class="reference external" href="posts/mirar-tu-smartphone-para-cuidar.html">propuesta</a> sobre una aplicación para teléfonos inteligentes que facilite el relevamiento
de precios y ayude a encontrar mejores ofertas generó muchísimo debate en <a class="reference external" href="http://listas.python.org.ar/pipermail/pyar/2013-June/thread.html#24966">PyAr</a>, en la
<a class="reference external" href="http://www.textosypretextos.com.ar/spip.php?page=recherche&amp;recherche=limando+cantos">lista de Ingeniería</a>  y en <a class="reference external" href="https://twitter.com/tin_nqn_/status/340839648798580736">Twitter</a> .</p>
<p>Hubo quienes desmerecieron la idea por "<a class="reference external" href="http://listas.python.org.ar/pipermail/pyar/2013-June/024967.html">politizada</a>", otros que me <a class="reference external" href="http://listas.python.org.ar/pipermail/pyar/2013-June/024977.html">invitaron a no generar polémica</a> y llevar la discusión a otro lado <a class="footnote-reference" href="posts/hola-preciosa.html#id4" id="id1">[1]</a>, un par que no les gustó porque le quita <em>"la responsabilidad al gobierno que es el que genera inflación por su irresponsable emisión monetaria"</em>  y otros que directamente se <a class="reference external" href="http://listas.python.org.ar/pipermail/pyar/2013-June/024988.html">ofendieron feo</a> y dijeron que era fascista.</p>
<blockquote class="twitter-tweet" data-conversation="none" lang="es"><p>@<a href="https://twitter.com/tin_nqn_">tin_nqn_</a> @<a href="https://twitter.com/damian_avila">damian_avila</a> por dios.eso es programar al gran hermano. Facismo en código</p>— JuanB. Cabral (@JuanBCabral) <a href="https://twitter.com/JuanBCabral/status/340955059607187457">1 de junio de 2013</a></blockquote>

<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>Pero a la gran mayoría le pareció buena, de difundió bastante en facebook, muchos aportaron nuevas ideas para mejorarla y otros muchos se entusiasmaron en colaborar.</p>
<p>Así que de eso se trata este post: encauzar todas esas ideas y ganas que se generaron para diseñar e implementar el software. Se me ocurrió el nombre <strong>Preciosa</strong> <a class="footnote-reference" href="posts/hola-preciosa.html#id5" id="id2">[2]</a>, por <strong>"Precios de Argentina"</strong> <a class="footnote-reference" href="posts/hola-preciosa.html#id6" id="id3">[3]</a>, pero se puede cambiar más adelante.</p>
<div class="section" id="como-empezamos-preciosa">
<h2>¿Cómo empezamos(,) Preciosa?</h2>
<p>Hice una lista de correos (<a class="reference external" href="https://groups.google.com/forum/?fromgroups#!forum/preciosa-devs">preciosa-devs@googlegroups.com</a>.</p>
<p>Están invitados programadores/as, diseñadore/as, periodistas y todos y todas quienes tengan algo para aportar al proyecto. Es el lugar para discutir ideas de diseño, difusión e implementación, avisar de apps parecidas o útiles, etc.</p>
<p>También dí de alta el proyecto en Github: <a class="reference external" href="https://github.com/mgaitan/preciosa">https://github.com/mgaitan/preciosa</a></p>
<p>Además del repositorio usaremos la <a class="reference external" href="https://github.com/mgaitan/preciosa/wiki">Wiki</a> para resumir los acuerdos de diseño y la <a class="reference external" href="https://github.com/mgaitan/preciosa/issues">issue tracker</a> para listar las tareas y funcionalidades a implementar, pedir nuevas, reportar errores, etc.</p>
<p>Este será el proyecto padre y allí pondremos el código de la aplicación "servidor", es decir la que proveerá la API para que las aplicaciones móviles bajen y suban información de precios. Luego de que decidamos más o menos cómo
será esta API podemos crear un proyecto nuevo para cada una de las aplicaciones clientes de las distintas plataformas mobile (la prioridad debería ser Android y Blackberry, ¿no?).</p>
<p>Porque es lo que yo sé programar, porque es fácil aprenderlo y porque satisface (con creces) tecnológicamente el problema, la aplicación servidor la haremos en <a class="reference external" href="http://">Django</a>.</p>
<p>¿Manos a la obra?</p>
<!-- attention:

Si sabés programar en python, web o cualquier tecnología mobile; sabes diseñar o maquetar css, o simplemente te gusta la idea, te esperamos en la nueva y preciosa lista_ -->
<table class="docutils footnote" frame="void" id="id4" rules="none"><colgroup><col class="label"><col></colgroup><tbody valign="top"><tr><td class="label"><a class="fn-backref" href="posts/hola-preciosa.html#id1">[1]</a></td><td>¿esta actitud no es una "<a class="reference external" href="http://www.ted.com/talks/lang/es/eli_pariser_beware_online_filter_bubbles.html">burbuja de filtros</a>", voluntaria? ¿No es <em>"reducir
nuestra visión del mundo"</em> como dice Eli Pariser?</td></tr></tbody></table><table class="docutils footnote" frame="void" id="id5" rules="none"><colgroup><col class="label"><col></colgroup><tbody valign="top"><tr><td class="label"><a class="fn-backref" href="posts/hola-preciosa.html#id2">[2]</a></td><td>Esteban Morales propuso "DeCompras", que es más explícito e internacionalizable</td></tr></tbody></table><table class="docutils footnote" frame="void" id="id6" rules="none"><colgroup><col class="label"><col></colgroup><tbody valign="top"><tr><td class="label"><a class="fn-backref" href="posts/hola-preciosa.html#id3">[3]</a></td><td>o porque me inspiró su <a class="reference external" href="https://plus.google.com/photos/102449284377784435533/albums/5362561505342208481/5362561730845131554?pid=5362561730845131554&amp;oid=102449284377784435533">belleza</a></td></tr></tbody></table></div>
        <p>
        
            <a href="posts/hola-preciosa.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/mirar-tu-smartphone-para-cuidar.html">Mirar (tu smartphone) para cuidar</a>
        <small>  
             <span class="timeago" title="2013-06-01 09:50:39">2013-06-01 09:50:39</span>
        </small></h1>
        <!-- link: -->
<!-- description: -->
<!-- tags: ideas, android, preciosa -->
<!-- date: 2013/06/01 09:50:39 -->
<!-- title: Mirar (tu smartphone) para cuidar -->
<!-- slug: mirar-tu-smartphone-para-cuidar -->
<p>Leo sobre el programa <a class="reference external" href="http://www.pagina12.com.ar/diario/economia/subnotas/221350-63733-2013-06-01.html">Mirar para cuidar</a>, la campaña de acción voluntaria para controlar el cumplimiento
del <a class="reference external" href="http://www.preciosensusitio.gov.ar/">acuerdo de precios</a> con los supermercados.</p>
<iframe width="420" height="315" src="http://www.youtube.com/embed/I5jQZ8xQ5Pw" frameborder="0" allowfullscreen></iframe><p>Me parece muy bueno todo este paquete de medidas y negociaciones que,
en vez de <a class="reference external" href="https://www.youtube.com/watch?v=tmoOnEIzU18">negar la situación</a>, la
asume y la enfrenta, con medidas simples e ingeniosas. La inflación, creo yo, es el flagelo más sentido por todo el pueblo trabajador.</p>
<p>¿Pero será efectivo tener a tantos compañeros mirando y anotando el precio del paquete de harina
en una hoja de papel?</p>
<p>Supongamos que está más caro de lo acordado ¿Qué va a pasar? Imagino que los voluntarios
tendrán que informarlo a las autoridades de la Secretaria de Comercio y desde allí
deberán enviar a alguien con poder de policia que constate, para luego multar y exigir
la adecuación del precio. ¿Cuantos días lleva eso? ¿Cuanta gente compró la harina más cara
mientras tanto? ¿Cuánto esfuerzo de trabajo significó, no sólo de los voluntarios, sino de los funcionarios? ¿Cuántas posibilidades reales hay de implementar esto en todos los rincones
del país?</p>
<p>Y otra cosa ¿Qué va a pasar con todos los productos que están fuera del acuerdo y no hay
referencia para comparar?</p>
<p>Entonces me acordé de una idea que tuve en la era los celulares sin chip, pero que ahora
es muy factible.</p>
<div class="section" id="una-aplicacion-popular-para-el-control-de-precios">
<h2>Una aplicación "popular" para el control de precios</h2>
<p>Hace 1 año, el <a class="reference external" href="http://www.lanacion.com.ar/1473620-el-smartphone-otra-pasion-argentina">24% de los argentinos tenía un smartphone</a>  y sospecho que, como yo, muchos nos compramos uno
hace menos tiempo. Más de 10 millones de personas que pueden controlar precios con un botón
de su aparatito móvil:</p>
<p>La aplicación que imagino es una base de datos centralizada que los propios usuarios pueden ampliar.</p>
<p>Entran a un super, agarran el paquete de harina, le sacan una fotito con su cámara al código
de barra (o buscan el producto por nombre, marca, etc.) y la <em>app</em> les dice cuál es el
precio de referencia (o del acuerdo), en qué super cercano está más barato,
cuándo y cuánto aumentó, etc.</p>
<p>El usuario puede anotar el precio que está viendo y enviarlo a la base de datos (diciendo
de qué supermercado y sucursal se trata, que podría inferirse a través de geolocalización)
y así contribuir y actualizar los datos.</p>
<p>Este simple proceso de carga de datos distribuída permitiría no sólo controlar el acuerdo de
precios (reemplazando o ayudando eficientemente a los voluntarios mirones) y habilitar a
Moreno (te banco, sabelo) a encajar unas buenas multas, sino algo mucho más efectivo: <strong>que la gente sepa a priori</strong>, mirando su teléfono o la web, <strong>dónde comprar más barato y quién/es la están cagando</strong>.</p>
<p>Por otro lado, la exposición pública de los precios históricos alentaría la competencia de los super, que suelen tener esas políticas estilo <em>"te devolvemos la plata si encontrás un precio más barato"</em> pero que resultan ser mero marketing por la dificultad de utilizarlas.</p>
<p>¡Imaginate la cantidad de datos para analizar! Por ejemplo, ¿cuánto aumentaron en promedio
los productos de <a class="reference external" href="http://www.taringa.net/posts/noticias/12546172/Empresa-que-manejan-casi-todos-los-productos-del-hogar.html">Unilever</a> o <a class="reference external" href="http://www.taringa.net/posts/info/3231784/Kraft-Terrabusi-150-despidos.html">Kraft</a> ? ¿no resultará que son esas empresas (entre otras) las que tienen la batuta de los precios? ¿No podrémos, al menos, escracharlos y boicotearlos?</p>
<p><em>"¡Subiste un 35% las sardinas desde el mes pasado, hijuepú!, ¡Minga te voy a comprar!"</em></p>
</div>
<div class="section" id="lo-hacemos">
<h2>¿Lo hacemos?</h2>
<p>No tengo idea de cómo se hacen aplicaciones para smartphones <a class="footnote-reference" href="posts/mirar-tu-smartphone-para-cuidar.html#id2" id="id1">[1]</a>, pero sí puedo ayudar en
la API/base datos/web.</p>
<p>Así que busco voluntarios para el programa <em>"Programar para cuidar"</em> ;-).</p>
<blockquote>
PD: ¿No se copará la secretaria de defensa del consumidor en poner unos pesos para
hacer esto?</blockquote>
<table class="docutils footnote" frame="void" id="id2" rules="none"><colgroup><col class="label"><col></colgroup><tbody valign="top"><tr><td class="label"><a class="fn-backref" href="posts/mirar-tu-smartphone-para-cuidar.html#id1">[1]</a></td><td>en verdad, ideas tengo, lo que no tengo son certezas</td></tr></tbody></table></div>
        <p>
        
            <a href="posts/mirar-tu-smartphone-para-cuidar.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/pip-apurate-por-favor.html">pip, apurate por favor</a>
        <small>  
             <span class="timeago" title="2013-04-10 01:17:55">2013-04-10 01:17:55</span>
        </small></h1>
        <!-- title: pip, apurate por favor -->
<!-- slug: pip-apurate-por-favor -->
<!-- date: 2013/04/10 01:17:55 -->
<!-- tags: pip, python -->
<!-- description: -->
<p><a class="reference external" href="http://pip-installer.org/">pip</a>  es una herramienta esencial
para el trabajo diario de un programador python: es el manejador
de paquetes de nuestro entorno de trabajo (¡<a class="reference external" href="http://www.virtualenv.org/en/latest/">virtual</a> por favor!),
con el que instalamos, actualizamos o eliminamos las dependencias de nuestro proyecto
(y, recursivamente, las dependencias que estas pudieran tener).</p>
<p>Conceptualmente es similar a los manejadores de paquetes de sistema como <tt class="docutils literal"><span class="pre">apt-get</span></tt>,
diferenciándose en que, por defecto, <em>consulta cada vez</em> a una <a class="reference external" href="https://pypi.python.org/pypi/">base de
datos online</a> si el paquete solicitado existe y de dónde
puede bajar la última versión o la específica que se haya pedido.</p>
<p>Responder "qué, cuál y de dónde" es una tarea lenta porque dicha base de datos no es
más que una página html por cada paquete con links que funcionan como un índice (como
<a class="reference external" href="https://pypi.python.org/simple/lxml/">este</a>  que pip
<a class="reference external" href="https://github.com/pypa/pip/blob/f1fb4b4fda127529e24b71a4e03bb0b5df484ef6/pip/index.py#L141">debe parsear</a>
comparar y elegir la mejor opción para bajar (a veces incluso debe parsear la homepage
del proyecto en busca de links de descarga, puaj!).</p>
<p>Por eso (y porque muchas veces la infraestructura se satura) el uso estándar de pip es lento.
Pero hay algunas maneras de que lo sea menos. Veámoslas.</p>
<div class="section" id="no-bajes-dos-veces-lo-mismo">
<h2>No bajes dos veces lo mismo</h2>
<p>El funcionamiento básico de pip es instalar un paquete con <tt class="docutils literal">pip install &lt;paquete&gt;</tt>: busca, baja e
instala el paquete. El flag <tt class="docutils literal"><span class="pre">--download_cache=&lt;path&gt;</span></tt> evita repetir el paso del medio,
cosa tediosa cuando tenemos que instalar frecuentemente (por ejemplo en distintos virtualenvs)
la misma dependencia o cuando el uso de ancho de banda es limitado.</p>
<p>Por ejemplo instalamos por primera vez <a class="reference external" href="http://lxml.de/">lxml</a> y vemos cuanto tarda.</p>
<pre class="code bash literal-block">
<span class="o">(</span><span class="nb">test</span><span class="o">)</span>tin@traful:~/lab/test<span class="nv">$ </span><span class="nb">time </span>pip install lxml --download-cache<span class="o">=</span>~/.pip_download
Downloading/unpacking lxml
  Downloading lxml-3.1.1.tar.gz <span class="o">(</span>3.3MB<span class="o">)</span>: 3.3MB downloaded
  Storing download in cache at /home/tin/.pip_download_cache/https%3A%2F%2Fpypi.python.org%2Fpackages%2Fsource%2Fl%2Flxml%2Flxml-3.1.1.tar.gz
  Running setup.py egg_info <span class="k">for </span>package lxml
    Building lxml version 3.1.1.

    <span class="o">[</span>... compilación<span class="o">]</span>


Successfully installed lxml
Cleaning up...

real    2m58.276s
user    0m38.822s
sys 0m0.676s
<span class="o">(</span><span class="nb">test</span><span class="o">)</span>tin@traful:~/lab/test<span class="err">$</span>
</pre>
<p>¡3 minutos! Y eso que estoy en una conexión bastante rápida.</p>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p>Cualquier flag que pip acepta en su linea de comando se puede configurar como una
<a class="reference external" href="http://www.pip-installer.org/en/latest/configuration.html#environment-variables">variable de entorno</a>. Entonces podemos setear flag por defecto en nuestro <tt class="docutils literal">.bashrc</tt>,
por ejemplo.. code-block: bash</p>
<blockquote class="last">
export PIP_DOWNLOAD_CACHE=~/.pip_download_cache</blockquote>
</div>
<p>Pero sigamos: una vez cacheado, las siguientes veces que queramos instalar la misma versión de lxml
no bajará <strong>el archivo</strong> de nuevo</p>
<pre class="code bash literal-block">
<span class="o">(</span>test2<span class="o">)</span>tin@traful:~/lab/test2<span class="nv">$ </span><span class="nb">time </span>pip install lxml --download-cache<span class="o">=</span>~/.pip_download

Downloading/unpacking lxml
  Using download cache from /home/tin/.pip_download_cache/https%3A%2F%2Fpypi.python.org%2Fpackages%2Fsource%2Fl%2Flxml%2Flxml-3.1.1.tar.gz
  Running setup.py egg_info <span class="k">for </span>package lxml
    Building lxml version 3.1.1.

    <span class="o">[</span>... compilación<span class="o">]</span>

Successfully installed lxml
Cleaning up...

real    2m30.624s
user    0m38.966s
sys 0m0.504s
</pre>
<p>Mejoró realmente poco. ¿que clase de caché es esta?
Chusmeemos que hay en el directorio.</p>
<pre class="code bash literal-block">
<span class="o">(</span><span class="nb">test</span><span class="o">)</span>tin@traful:~/lab/test<span class="nv">$ </span>ls ~/.pip_download_cache/ | grep lxml
https%3A%2F%2Fpypi.python.org%2Fpackages%2Fsource%2Fl%2Flxml%2Flxml-3.1.1.tar.gz
https%3A%2F%2Fpypi.python.org%2Fpackages%2Fsource%2Fl%2Flxml%2Flxml-3.1.1.tar.gz.content-type
</pre>
<p>¿Caché de urls? <tt class="docutils literal"><span class="pre">-download-cache</span></tt> no evita todo el laburo de averiguar de dónde bajar,
sino simplemente no baja si la url resultante ya existe (como nombre de un archivo)
en este directorio.</p>
<p>Lo explica simple <a class="reference external" href="https://github.com/pypa/pip/issues/680#issuecomment-8773509">Carl Meyer</a>:</p>
<blockquote>
La función <tt class="docutils literal"><span class="pre">--download-cache</span></tt> no apunta a prevenir la búsqueda en la red del archivo
correcto a bajar: todo lo que hace es guardarlo una vez que lo encontró.
Si de verdad te interesa instalar tus depedencias desde tu compu (sin salir a la red)
usá <tt class="docutils literal"><span class="pre">--download</span></tt> primero y luego <tt class="docutils literal"><span class="pre">--find-links</span></tt> (apuntando al path de descarga) con
<tt class="docutils literal"><span class="pre">--no-index</span></tt>.</blockquote>
</div>
<div class="section" id="una-cache-sin-salir-a-la-red">
<h2>Una caché sin salir a la red</h2>
<p>Sigamosle la corriente al bueno de <a class="reference external" href="https://twitter.com/carljm">@carljm</a>:</p>
<pre class="code bash literal-block">
<span class="o">(</span>test3<span class="o">)</span>tin@traful:~/lab/test3<span class="nv">$ </span><span class="nb">time </span>pip install --download<span class="o">=</span>~/.pip_packages lxml
Downloading/unpacking lxml
  Using download cache from /home/mgaitan/.pip_download_cache/https%3A%2F%2Fpypi.python.org%2Fpackages%2Fsource%2Fl%2Flxml%2Flxml-3.1.1.tar.gz
Saved /home/mgaitan/.pip_packages/lxml-3.1.1.tar.gz
    <span class="o">[</span>...<span class="o">]</span>

Successfully downloaded lxml
Cleaning up...

real    2m8.969s
user    0m1.008s
sys 0m0.136s
</pre>
<p>¡Uff, 2 minutos en copiar un archivo que ya tenía bajado! (evidentemente lo que demora mucho
es <em>averiguar</em> la versión del archivo a bajar)</p>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last">se puede inspeccionar el berenjenal de redirecciones y parseos que suceden hasta que pip
da con el paquete lxml a bajar haciendo el comando más verborrágico con
<tt class="docutils literal">pip install lxml <span class="pre">-vvv</span></tt></p>
</div>
<p>En este caso, el caché es directamente el archivo:</p>
<pre class="code bash literal-block">
<span class="o">(</span><span class="nb">test</span><span class="o">)</span>mgaitan@traful:~/lab/test<span class="nv">$ </span>ls ~/.pip_packages/ | grep lxml
lxml-3.1.1.tar.gz
</pre>
<p>Por suerte, una vez cacheado el paquete de esta manera no tendremos
que consultar el índice online las siguientes veces.</p>
<pre class="code bash literal-block">
<span class="o">(</span>test3<span class="o">)</span>mgaitan@traful:~/lab/test3<span class="nv">$ </span><span class="nb">time </span>pip install --no-index --find-links<span class="o">=</span>~/.pip_packages lxml
Ignoring indexes: https://pypi.python.org/simple/
Downloading/unpacking lxml
  Running setup.py egg_info <span class="k">for </span>package lxml
    Building lxml version 3.1.1.

    <span class="o">[</span>...<span class="o">]</span>


Successfully installed lxml
Cleaning up...

real    0m38.944s
user    0m38.338s
sys 0m0.564s
</pre>
<p>Ok, ya va mejor.</p>
</div>
<div class="section" id="haciendo-que-la-cosa-vuele-no-recompiles-la-rueda">
<h2>Haciendo que la cosa vuele: no recompiles la rueda</h2>
<p>pip 1.4 (en desarrollo) trae <a class="reference external" href="https://github.com/pypa/pip/commit/5d02b5207a305543ad6ef19d6e6596ffa45b99e5">soporte integrado</a> para el nuevo formato de paquetes
<a class="reference external" href="http://wheel.rtfd.org/,">wheel</a> (superador del viejo <em>egg</em> y basado en los estándares actuales)
que es muchísimo más rápido que instalar desde fuentes (sobre todo en casos
que se debe compilar, como lxml)</p>
<p>Para usar wheel el paquete a bajar tiene que existir en dicho formato y todavía no abundan
en PyPi asi que podemos armarlos localmente con el propio pip</p>
<pre class="code bash literal-block">
pip wheel --wheel-dir<span class="o">=</span>./pip_packages lxml
</pre>
<p>Eso es similar a usar <tt class="docutils literal"><span class="pre">--download</span></tt> pero además compila y empaqueta como
un archivo <tt class="docutils literal">.whl</tt></p>
<p>Para que pip acepte instalar estos archivos hay que usar <tt class="docutils literal"><span class="pre">--use-wheel</span></tt>
y para que los busque localmente haremos:</p>
<pre class="code bash literal-block">
pip install --use-wheel --no-index --find-links<span class="o">=</span>~/.pip_packages lxml
</pre>
<p>¡Lo que tardó menos de 2 decimas de segundo! Un speedup del 90mil veces respecto al primer
y canónico <tt class="docutils literal">pip install lxml</tt></p>
<pre class="code literal-block">
(test)tin@morochita:~/lab/test$ time pip install --use-wheel --no-index --find-links=. lxml
Ignoring indexes: https://pypi.python.org/simple/
Downloading/unpacking lxml
Installing collected packages: lxml
Successfully installed lxml
Cleaning up...

real    0m0.180s
user    0m0.152s
sys 0m0.024s
</pre>
<p>Asi que ya sabés: todos esos paquetes que instalás en cada entorno (quizas ipython,
django, whatever) me los haces rodar para que pip vuele.</p>
</div>
        <p>
        
            <a href="posts/pip-apurate-por-favor.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/desambiguando-un-hash-en-git.html">Desambiguando un hash en Git</a>
        <small>  
             <span class="timeago" title="2013-03-14 18:02:01">2013-03-14 18:02:01</span>
        </small></h1>
        <!-- title: Desambiguando un hash en Git -->
<!-- slug: desambiguando-un-hash-en-git -->
<!-- date: 2013/03/14 18:02:01 -->
<!-- tags: -->
<!-- link: -->
<!-- description: -->
<p>Soy vago. Por eso me llevo bien con Git, que permite reconocer un changeset con un <a class="reference external" href="http://git-scm.com/book/ch6-1.html">pedacito de
su hash sha1</a> :</p>
<blockquote>
Git is smart enough to figure out what commit you meant to type if you provide the first few characters, as long as your partial SHA-1 is at least four characters long and unambiguous — that is, only one object in the current repository begins with that partial SHA-1.</blockquote>
<p>Pero a veces soy demasiado vago, y Git deja de llevarse bien conmigo: Estaba en una rama con varios commits y quería volver al pasado, deshaciendo commits, pero llevando uno. Fácil: <tt class="docutils literal">reset</tt> + <tt class="docutils literal"><span class="pre">cherry-pick</span></tt>. Pero copié muy pocos caracteres del hash que quería <em>cherrypickear</em>:</p>
<pre class="code bash literal-block">
<span class="o">(</span>cpi<span class="o">)</span>tin@morochita:~/cpi<span class="nv">$ </span>git reset --hard 772dad9a775
HEAD is now at 772dad9 making aqueous migration script more robust
<span class="o">(</span>cpi<span class="o">)</span>tin@morochita:~/cpi<span class="nv">$ </span>git cherry-pick c4396
error: short SHA1 c4396 is ambiguous.
error: short SHA1 c4396 is ambiguous
fatal: ambiguous argument <span class="s1">'c4396'</span>: unknown revision or path not in the working tree.
Use <span class="s1">'--'</span> to separate paths from revisions
<span class="o">(</span>cpi<span class="o">)</span>mgaitan@gutemberg:~/laburo/cpi/code/cpi_mrp<span class="err">$</span>
</pre>
<p>Recórcholis.</p>
<p>Un poquito de bash y <em>git plumbing</em> al rescate:</p>
<pre class="code bash literal-block">
<span class="o">(</span>cpi<span class="o">)</span>tin@morochita:~/cpi<span class="nv">$ </span><span class="k">for </span><span class="nb">hash </span>in c4396<span class="o">{{</span>0..9<span class="o">}</span>,<span class="o">{</span>a..f<span class="o">}}</span>; <span class="k">do </span>git cat-file -e <span class="nv">$hash</span> <span class="o">&amp;&amp;</span> git rev-parse <span class="nv">$hash</span>; <span class="k">done </span>2&gt;/dev/nul
c4396586273b2a9ea5eae46c4ab2d98e236e7792
c4396a2d64214a28791e4ba5a4a4017bdd9d14d6
</pre>
<p>Ahora tenemos el conjunto de hash con igual prefijo, y podemos revisarlos para ver cual era el que queriamos:</p>
<pre class="code bash literal-block">
<span class="o">(</span>cpi<span class="o">)</span>tin@morochita:~/cpi<span class="nv">$ </span>git show c4396586273b2a9ea5eae46c4ab2d98e236e7792
</pre>
<p>Y ese era el que quería.</p>
        <p>
        
            <a href="posts/desambiguando-un-hash-en-git.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/como-funciona-cuevana.html">Cómo funciona Cuevana</a>
        <small>  
             <span class="timeago" title="2013-03-07 10:17:55">2013-03-07 10:17:55</span>
        </small></h1>
        <!-- title: Cómo funciona Cuevana -->
<!-- slug: como-funciona-cuevana -->
<!-- date: 2013/03/07 10:17:55 -->
<!-- tags: cuevana, scrapping -->
<!-- link: -->
<!-- description: -->
<p>Estimando cuanto trabajo significa actualizar <a class="reference external" href="http://userscripts.org/scripts/show/98017">Cuevana sources</a>
y/o <a class="reference external" href="https://bitbucket.org/tin_nqn/cuevanalib">Cuevanalib</a>
investigué cómo funciona la nueva versión de cuevana.</p>
<p>Estas notas son el resultado de lo que fui observando.</p>
<p>Una vez que se elige un contenido, un iframe apunta a una URL con este forma:</p>
<blockquote>
<a class="reference external" href="http://www.cuevana.tv/player/sources?id=4773&amp;tipo=pelicula">http://www.cuevana.tv/player/sources?id=4773&amp;tipo=pelicula</a></blockquote>
<p>En código javascript inline define las fuentes disponibles para ese contenido</p>
<pre class="code javascript literal-block">
<span class="kd">var</span> <span class="nx">plugin_ver</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">plugin_rev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">actual_ver</span><span class="p">,</span> <span class="nx">actual_rev</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">sources</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"2"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">"360"</span><span class="o">:</span> <span class="p">[</span><span class="s2">"uptobox"</span><span class="p">,</span> <span class="s2">"uploadcore"</span><span class="p">,</span> <span class="s2">"vidbull"</span><span class="p">,</span> <span class="s2">"bayfiles"</span><span class="p">,</span> <span class="s2">"filebox"</span><span class="p">,</span> <span class="s2">"cramit"</span><span class="p">,</span> <span class="s2">"zalaa"</span><span class="p">],</span>
        <span class="s2">"720"</span><span class="o">:</span> <span class="p">[</span><span class="s2">"uploadcore"</span><span class="p">,</span> <span class="s2">"vidbull"</span><span class="p">,</span> <span class="s2">"bayfiles"</span><span class="p">,</span> <span class="s2">"cramit"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nx">sel_source</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</pre>
<p>La primer clave (en este caso <tt class="docutils literal">2</tt>, inglés) es el idioma del audio,
y la segunda la calidad del video</p>
<p>Luego define diferentes constates:</p>
<pre class="code javascript literal-block">
<span class="kd">var</span> <span class="nx">label</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'360'</span><span class="o">:</span> <span class="s1">'SD (360p)'</span><span class="p">,</span>
    <span class="s1">'480'</span><span class="o">:</span> <span class="s1">'SD (480p)'</span><span class="p">,</span>
    <span class="s1">'720'</span><span class="o">:</span> <span class="s1">'HD (720p)'</span><span class="p">,</span>
    <span class="s1">'1080'</span><span class="o">:</span> <span class="s1">'HD (1080p)'</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">labeli</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"1"</span><span class="o">:</span> <span class="s2">"Espa\u00f1ol"</span><span class="p">,</span>
    <span class="s2">"2"</span><span class="o">:</span> <span class="s2">"Ingl\u00e9s"</span><span class="p">,</span>
    <span class="s2">"3"</span><span class="o">:</span> <span class="s2">"Portugu\u00e9s"</span><span class="p">,</span>
    <span class="s2">"4"</span><span class="o">:</span> <span class="s2">"Alem\u00e1n"</span><span class="p">,</span>
    <span class="s2">"5"</span><span class="o">:</span> <span class="s2">"Franc\u00e9s"</span><span class="p">,</span>
    <span class="s2">"6"</span><span class="o">:</span> <span class="s2">"Coreano"</span><span class="p">,</span>
    <span class="s2">"7"</span><span class="o">:</span> <span class="s2">"Italiano"</span><span class="p">,</span>
    <span class="s2">"8"</span><span class="o">:</span> <span class="s2">"Tailand\u00e9s"</span><span class="p">,</span>
    <span class="s2">"9"</span><span class="o">:</span> <span class="s2">"Ruso"</span><span class="p">,</span>
    <span class="s2">"10"</span><span class="o">:</span> <span class="s2">"Mongol"</span><span class="p">,</span>
    <span class="s2">"11"</span><span class="o">:</span> <span class="s2">"Polaco"</span><span class="p">,</span>
    <span class="s2">"12"</span><span class="o">:</span> <span class="s2">"Esloveno"</span><span class="p">,</span>
    <span class="s2">"13"</span><span class="o">:</span> <span class="s2">"Sueco"</span><span class="p">,</span>
    <span class="s2">"14"</span><span class="o">:</span> <span class="s2">"Griego"</span><span class="p">,</span>
    <span class="s2">"15"</span><span class="o">:</span> <span class="s2">"Canton\u00e9s"</span><span class="p">,</span>
    <span class="s2">"16"</span><span class="o">:</span> <span class="s2">"Japon\u00e9s"</span><span class="p">,</span>
    <span class="s2">"17"</span><span class="o">:</span> <span class="s2">"Dan\u00e9s"</span><span class="p">,</span>
    <span class="s2">"18"</span><span class="o">:</span> <span class="s2">"Neerland\u00e9s"</span><span class="p">,</span>
    <span class="s2">"19"</span><span class="o">:</span> <span class="s2">"Hebreo"</span><span class="p">,</span>
    <span class="s2">"20"</span><span class="o">:</span> <span class="s2">"Serbio"</span><span class="p">,</span>
    <span class="s2">"21"</span><span class="o">:</span> <span class="s2">"\u00c1rabe"</span><span class="p">,</span>
    <span class="s2">"22"</span><span class="o">:</span> <span class="s2">"Hindi"</span><span class="p">,</span>
    <span class="s2">"23"</span><span class="o">:</span> <span class="s2">"Noruego"</span><span class="p">,</span>
    <span class="s2">"24"</span><span class="o">:</span> <span class="s2">"Turco"</span><span class="p">,</span>
    <span class="s2">"26"</span><span class="o">:</span> <span class="s2">"Mandar\u00edn"</span><span class="p">,</span>
    <span class="s2">"27"</span><span class="o">:</span> <span class="s2">"Nepal\u00e9s"</span><span class="p">,</span>
    <span class="s2">"28"</span><span class="o">:</span> <span class="s2">"Rumano"</span><span class="p">,</span>
    <span class="s2">"29"</span><span class="o">:</span> <span class="s2">"Iran\u00ed"</span><span class="p">,</span>
    <span class="s2">"30"</span><span class="o">:</span> <span class="s2">"Est\u00f3n"</span><span class="p">,</span>
    <span class="s2">"31"</span><span class="o">:</span> <span class="s2">"Bosnio"</span><span class="p">,</span>
    <span class="s2">"32"</span><span class="o">:</span> <span class="s2">"Checo"</span><span class="p">,</span>
    <span class="s2">"33"</span><span class="o">:</span> <span class="s2">"Croata"</span><span class="p">,</span>
    <span class="s2">"34"</span><span class="o">:</span> <span class="s2">"Fin\u00e9s"</span><span class="p">,</span>
    <span class="s2">"35"</span><span class="o">:</span> <span class="s2">"H\u00fanagro"</span><span class="p">,</span>
    <span class="s2">"36"</span><span class="o">:</span> <span class="s2">"Persa"</span><span class="p">,</span>
    <span class="s2">"38"</span><span class="o">:</span> <span class="s2">"Indonesio"</span>
<span class="p">};</span>
<span class="kd">var</span> <span class="nx">labelh</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'filebox'</span><span class="o">:</span> <span class="s1">'Filebox'</span><span class="p">,</span>
    <span class="s1">'uptobox'</span><span class="o">:</span> <span class="s1">'Uptobox (NUEVO)'</span><span class="p">,</span>
    <span class="s1">'uploadcore'</span><span class="o">:</span> <span class="s1">'Uploadcore (NUEVO)'</span><span class="p">,</span>
    <span class="s1">'vidbull'</span><span class="o">:</span> <span class="s1">'Vidbull (NUEVO)'</span><span class="p">,</span>
    <span class="s1">'zalaa'</span><span class="o">:</span> <span class="s1">'Zalaa'</span><span class="p">,</span>
    <span class="s1">'cramit'</span><span class="o">:</span> <span class="s1">'Cramit'</span><span class="p">,</span>
    <span class="s1">'180upload'</span><span class="o">:</span> <span class="s1">'180upload'</span><span class="p">,</span>
    <span class="s1">'bayfiles'</span><span class="o">:</span> <span class="s1">'Bayfiles'</span>
<span class="p">};</span>
</pre>
<p>El usuario selecciona mediante un menú donde se define <tt class="docutils literal">audio</tt>, <tt class="docutils literal">quality</tt> y <tt class="docutils literal">source</tt>
que se configuran como atributos data del link:</p>
<pre class="literal-block">
.. code-block::
</pre>
<blockquote>
&lt;a class="sel" data-type="quality" data-id="360"&gt;SD (360p)&lt;/a&gt;</blockquote>
<p>Donde <tt class="docutils literal"><span class="pre">data-type</span></tt> es el tipo de variable, <tt class="docutils literal"><span class="pre">data-id</span></tt> el valor para esa opción
y <tt class="docutils literal"><span class="pre">class="sel"</span></tt> determina si esa es la opción seleccionada.</p>
<p>Cuando se hace click en el botón Play se invoca la URL:</p>
<pre class="literal-block">
http://www.cuevana.tv/player/source_get?def=**quality**&amp;audio=**audio**&amp;host=**source**&amp;id=4773&amp;tipo=pelicula
</pre>
<p>Por ejemplo:</p>
<pre class="literal-block">
http://www.cuevana.tv/player/source_get?def=360&amp;audio=2&amp;host=bayfiles&amp;id=4773&amp;tipo=pelicula
</pre>
<p>Esta página presenta el captcha, que una vez superado redirige a la URL:</p>
<pre class="literal-block">
http://go.cuevana.tv/?*URL_DESTINO*
</pre>
<p>Por ejemplo:</p>
<pre class="literal-block">
http://go.cuevana.tv/?http%3A%2F%2Fbayfiles.com%2Ffile%2FvIsf%2FkTvfNj%2Fthe.apparition.2012.bdrip.xvid-sparks.mp4%3Fcid%3D4773%26ctipo%3Dpelicula%26cdef%3D360
</pre>
<p>Que a su vez redirige a <em>URL_DESTINO</em> que es la URL del servicio donde el video está hosteado
con parámetros extra: <tt class="docutils literal"><span class="pre">?cid=4773&amp;ctipo=pelicula&amp;cdef=360</span></tt>. En el ejemplo anterior:</p>
<blockquote>
<a class="reference external" href="http://bayfiles.com/file/vIsf/kTvfNj/the.apparition.2012.bdrip.xvid-sparks.mp4**?cid=4773&amp;ctipo=pelicula&amp;cdef=360**">http://bayfiles.com/file/vIsf/kTvfNj/the.apparition.2012.bdrip.xvid-sparks.mp4**?cid=4773&amp;ctipo=pelicula&amp;cdef=360**</a></blockquote>
<p>Aquí entra en juego el "plugin de cuevana". Se puede bajar por ejemplo
la versión para Firefox desde <a class="reference external" href="http://www.cuevana.tv/player/plugins/cstream-5.0.xpi">http://www.cuevana.tv/player/plugins/cstream-5.0.xpi</a>
Descomprimirlo con unzip y abrir el archivo <tt class="docutils literal">content/cuevanastream.js</tt></p>
<p>La presencia de los parámetros <tt class="docutils literal"><span class="pre">cid``y</span> ``ctipo</tt> y una url de alguno de los servicios
que usa Cuevana hace que se inyecte un javascript en la URL del servicio.</p>
<pre class="code javascript literal-block">
<span class="kd">var</span> <span class="nx">loc</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/cid=/i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/ctipo=/i</span><span class="p">));</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^http:\/\/(www\.)?bayfiles\.com/i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">loc</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">addScript</span><span class="p">(</span><span class="s1">'bayfiles'</span><span class="p">);</span>
<span class="p">}</span>

    <span class="c1">// más servicios
</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^http:\/\/(www\.|beta\.)?cuevana\.(com|co|tv|me)/i</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">);</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">'plugin_ok'</span><span class="p">;</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'data-version'</span><span class="p">,</span> <span class="s1">'5'</span><span class="p">);</span>
    <span class="nx">n</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'data-revision'</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">addScript</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'script'</span><span class="p">);</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'type'</span><span class="p">,</span> <span class="s1">'text/javascript'</span><span class="p">);</span>
    <span class="nx">s</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'src'</span><span class="p">,</span> <span class="s1">'http://sc.cuevana.tv/player/scripts/5/'</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">'.js'</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">'head'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
<span class="p">}</span>
</pre>
<p>En ese caso se inyecta el javascript:</p>
<pre class="literal-block">
http://sc.cuevana.tv/player/scripts/5/bayfiles.js
</pre>
<p>Que es el encargado de parsear html para obtener la url real de descarga,
resolver/exponer el captcha si existiera, esperar el tiempo de guarda
del servicio y redirigir al reproductor de cuevana:</p>
<pre class="literal-block">
window.location.href = 'http://www.cuevana.tv/#!/' + tipo + '/' + id + '/play/url:' + encodeURIComponent(a) + '/def:' + vars['cdef'];
</pre>
<p>Donde tipo es <tt class="docutils literal">series</tt> o <tt class="docutils literal">peliculas</tt>, <tt class="docutils literal">id</tt> es el identificador del contenido,
def es <tt class="docutils literal">360</tt> o <tt class="docutils literal">720</tt> y <tt class="docutils literal">a</tt> es la url final del archivo mp4</p>
<blockquote>
<a class="reference external" href="http://www.cuevana.tv/#!/">http://www.cuevana.tv/#!/</a>' + tipo + '/' + id + '/play/url:' + encodeURIComponent(a) + '/def:' + vars['cdef'];</blockquote>
<p>El reproductor carga el subtitulo desde la siguientes URL.</p>
<p>Para series:</p>
<blockquote>
<a class="reference external" href="http://sc.cuevana.tv/files/s/sub/">http://sc.cuevana.tv/files/s/sub/</a><strong>ID**_**LANG</strong>.srt</blockquote>
<p>Donde <tt class="docutils literal">ID</tt> es el identificador del contenido y <tt class="docutils literal">LANG</tt> es el código
del idioma en 2 letras mayúsculas (ES, EN, etc.)</p>
<p>Para contenidos HD se agrega el sufijo <em>_720</em>:</p>
<pre class="literal-block">
http://sc.cuevana.tv/files/s/sub/**ID**_**LANG**_720.srt
</pre>
<p>Para peliculas es análogo pero un nivel más arriba:</p>
<pre class="literal-block">
http://sc.cuevana.tv/files/sub/**ID**_**LANG**.srt
</pre>
<p>Y eso es todo lo que necesitamos saber.</p>
        <p>
        
            <a href="posts/como-funciona-cuevana.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/metiendose-cosas-en-la-nariz.html">Metiéndose cosas en la nariz</a>
        <small>  
             <span class="timeago" title="2013-02-26 22:17:55">2013-02-26 22:17:55</span>
        </small></h1>
        <!-- title: Metiéndose cosas en la nariz -->
<!-- slug: metiendose-cosas-en-la-nariz -->
<!-- date: 2013/02/26 22:17:55 -->
<!-- tags: -->
<!-- link: -->
<!-- description: -->
<p><a class="reference external" href="https://nose.readthedocs.org">nose</a> es un excelente <em>framework</em> para testing en python. Es mucho más
que un <em>testrunner</em> inteligente: tiene un conjunto de extensiones y shortcuts
de aserciones de <tt class="docutils literal">unittest</tt>, soporta fixtures y setups/teardown
por paquetes, y viene con un montón de plugins incorporados.</p>
<blockquote>
"nose extends unittest to make testing easier"</blockquote>
<p>dice el eslogan y eso es lo que queremos: tests más fáciles de escribir,
más rápidos de ejecutar.</p>
<p>De plugins y opciones que potencian esta idea se trata este post.</p>
<div class="section" id="nose-progressive">
<h2>nose-progressive</h2>
<blockquote class="epigraph">
<p>Ah, beautiful dots</p>
<p class="attribution">—<a class="reference external" href="http://blog.mozilla.org/webdev/2011/04/14/a-humane-python-test-runner/">Erik Rose</a></p>
</blockquote>
<p><em>"Puntito, puntito, puntito, puntito..."</em>, cuenta mi mente en standby
cuando los test van pasando, como ovejitas que saltan un cerco.
Pero, oh desdicha, una "efe", la oveja negra que falla, aparece
en la pantalla y la ansiedad por saber cuál nos invade.</p>
<p>El problema es que por default (con <tt class="docutils literal"><span class="pre">--verbose=1</span></tt>), nose
pospone el detalle de errores y fallos hasta el final de la corrida.
En suites gigantes (que demoran más de 30 minutos en completarse,
por ejemplo) esto es un engorro.</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/nose-progressive/">nose-progressive</a> reemplaza la interfaz de usuario por una mucho más
amigable y bonita. En vez de puntitos, una barra de progreso al pie de la
pantalla va indicando el progreso satisfactorio, y deja el resto de la pantalla
para mostrar errores y fallos <em>on the fly</em>.</p>
<img alt="https://raw.github.com/erikrose/nose-progressive/master/in_progress.png" src="https://raw.github.com/erikrose/nose-progressive/master/in_progress.png"><p>Como si fuera poco, te da shortcuts a la línea donde se produjo un fallo
(por ejemplo: <tt class="docutils literal">vim +258 common/tests/test_guideplan.py</tt>), simplifica los
tracebacks a la parte útil, e incluye colores usados con criterio
(basada en la genial biblioteca <a class="reference external" href="https://pypi.python.org/pypi/blessings">blessing</a>, del mismo autor).</p>
<p>Para instalarlo, lo de siempre:</p>
<pre class="code bash literal-block">
<span class="o">(</span>env<span class="o">)</span> <span class="nv">$ </span>pip install nose-progressive
</pre>
<p>Para usarlo, agregar <tt class="docutils literal"><span class="pre">--with-progressive</span></tt> como parámetros de <tt class="docutils literal">nosetests</tt>,
o bien, para usarlo siempre, configurarlo en <tt class="docutils literal">.noserc</tt> o en la
variable <tt class="docutils literal">NOSE_ARGS</tt> de <a class="reference external" href="https://github.com/jbalogh/django-nose">django-nose</a></p>
</div>
<div class="section" id="django-nose">
<h2>django-nose</h2>
<p>Si trabajás con Django esto quizas suene a perogrullada, pero <a class="reference external" href="https://github.com/jbalogh/django-nose">django-nose</a>
es la vuelta de tuerca que faltaba para que la nariz brille en este entorno.
Con django-nose por defecto sólo se corren los tests del proyecto y no
los de todas las aplicaciones instaladas (que, se supone, tienen sus propios
tests).</p>
<p>Y entre otras opciones o, tiene  un modo de reuso de la base de datos,
(configurando <tt class="docutils literal">REUSE_DB=1</tt> como variable de entorno), que nos evita la creación
de tablas en cada corrida, ahorrando unos cuantos segundos de setup en aplicaciones
como muchos modelos. Por supuesto, si la base de datos cambia (porque
se agregó un modelo o se se migró con <a class="reference external" href="http://south.aeracode.org/">South</a>) tenés que asegurarte
que la variable está en 0 para que cree la última version</p>
</div>
<div class="section" id="with-id-failed">
<h2>with-id + failed</h2>
<p>La opción <a class="reference external" href="https://nose.readthedocs.org/en/latest/usage.html?highlight=with-id#cmdoption--with-id">--with-id</a>
(estrictamente el plugin <tt class="docutils literal">TestId</tt>, que viene en las baterías incluídas de nose)
le asigna un número único a cada test ejecutado,
y los guarda en el archivito <tt class="docutils literal">.noseids</tt> junto con su path y el
resultado de la última corrida.</p>
<p>Lo bueno es que pasando <tt class="docutils literal"><span class="pre">--with-id</span> <span class="pre">--failed</span></tt> nose usa esa información
y ejecuta solamente los tests que fallaron en la última corrida,
permitiendo una rápida iteración <em>"falla/corrección"</em>.</p>
</div>
<div class="section" id="nose-selecttests">
<h2>nose-selecttests</h2>
<p>Frecuentemente sucede que tenemos caso (una subclase de <tt class="docutils literal">TestCase</tt>)
con muchas pruebas (métodos) que están lógicamente agrupadas
porque comparten un setup, por ejemplo,
y sin embargo sólo queremos correr un subconjunto.</p>
<p>Sabemos que como es inteligente y poco burocrático, nose no sólo ejecuta
tests definidos como subclases de <tt class="docutils literal">unittest.TestCase</tt> sino
cualquier paquete, módulo, función o clase
que <em>matchee</em> una expresión regular, que por defecto es <tt class="docutils literal"><span class="pre">(?:^|[b_./-])[Tt]est</span></tt>
Con el parámetro <a class="reference external" href="https://nose.readthedocs.org/en/latest/usage.html?highlight=with-id#cmdoption-m">-m</a>
se puede redefinir este patrón, pero igualmente no aplica a nivel
métodos.</p>
<p>Por eso existe <a class="reference external" href="https://github.com/iElectric/nose-selecttests">nose-selecttests</a>, que permite filtrar pruebas con
determinada subcadena en el nombre del método.</p>
<p>Por ejemplo:</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>djntest -v 2 common/tests/test_sequence_diff.py

<span class="c">#2976 test_differ_in_fk (cpi_mrp.apps.common.tests.test_sequence_diff.TestInstanceDiff) ... ok
#2977 test_differ_in_m2m (cpi_mrp.apps.common.tests.test_sequence_diff.TestInstanceDiff) ... ok
#2979 test_multiple_diff (cpi_mrp.apps.common.tests.test_sequence_diff.TestInstanceDiff) ... ok
#2980 test_only_compare_same_type (cpi_mrp.apps.common.tests.test_sequence_diff.TestInstanceDiff) ... ok
</span>
----------------------------------------------------------------------
Ran 4 tests in 0.375s
</pre>
<p>En cambio:</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>djntest --select-tests<span class="o">=</span>differ -v 2 apps/common/tests/test_sequence_diff.py

<span class="c">#2976 test_differ_in_fk (cpi_mrp.apps.common.tests.test_sequence_diff.TestInstanceDiff) ... ok
#2977 test_differ_in_m2m (cpi_mrp.apps.common.tests.test_sequence_diff.TestInstanceDiff) ... ok
</span>----------------------------------------------------------------------
Ran 2 tests in 0.088s
</pre>
</div>
<div class="section" id="django-tests-autocomplete">
<h2>django-tests-autocomplete</h2>
<p>Esta herramienta no es estrictamente un plugin de nose, sino un helper
que aprovecha las posibilidades de bash para
<a class="reference external" href="http://bash-completion.alioth.debian.org/">autocompletar</a> usando la tecla
tab.</p>
<p>¿Para qué sirve? nose acepta un path (o muchos) para especificar qué test correr:</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>nosetests path/to/test.py
</pre>
<p>Pero también permite afinar la puntería y "meterse" adentro del módulo:</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>nosetests path/to/test.py:MyImportantTestCase
</pre>
<p>E incluso adentro del testcase:</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>nosetests path/to/test.py:MyImportantTestCase.test_super_important
</pre>
<p>Desde el <tt class="docutils literal">:</tt> en adelante estamos en Python y Bash ya no sabe autocompletar,
salvo que usemos esta herramienta que instrospecciona y "alimenta" el
autocompleter.</p>
<p>Lo hizo Javi Mansilla en <a class="reference external" href="http://machinalis.com">Machinalis</a> y
<a class="reference external" href="https://github.com/machinalis/django-test-autocomplete#future-features">busca ayuda</a>
para mejorarlo y generalizarlo.</p>
<p>¿No sería buenísimo que esto estuviese built-in en nose? ¿Nos ayudarías?</p>
</div>
<div class="section" id="nose-timer">
<h2>nose-timer</h2>
<p>¿Cuánto tiempo insume cada test? Instalá <a class="reference external" href="https://github.com/mahmoudimus/nose-timer/">nose-timer</a> y activalo (con <tt class="docutils literal"><span class="pre">--with-timer</span></tt>)
para saber la respuesta.</p>
</div>
<div class="section" id="nose-ipdb">
<h2>nose-ipdb</h2>
<p>nose tiene una opción <tt class="docutils literal"><span class="pre">--pdb</span></tt> (o la más estricta <tt class="docutils literal"><span class="pre">--ipdb-failures</span></tt>)
que nos manda al debugger cuando un test falla o da error.</p>
<p><a class="reference external" href="https://github.com/flavioamieiro/nose-ipdb">nose-ipdb</a> lo imita, pero usando el más pulenta de los debuggers: <a class="reference external" href="https://pypi.python.org/pypi/ipdb">ipdb</a>.</p>
<p>Suficiente por hoy. Pero ¿me estoy perdiendo alguna cosa interesante
para meter en mi nariz?</p>
</div>
        <p>
        
            <a href="posts/metiendose-cosas-en-la-nariz.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/creando-un-nuevo-proyecto-python.html">Creando un nuevo proyecto Python</a>
        <small>  
             <span class="timeago" title="2012-11-12 00:34:23">2012-11-12 00:34:23</span>
        </small></h1>
        <!-- title: Creando un nuevo proyecto Python -->
<!-- slug: creando-un-nuevo-proyecto-python -->
<!-- date: 2012/11/12 00:34:23 -->
<!-- tags: python, tutorial -->
<!-- link: -->
<!-- description: -->
<p>¿Así que querés comenzar un nuevo proyecto usando Python?
¡Felicitaciones! ¿Querés que tenga la estructura recomendada para
proyectos modernos? ¿Querés que sea instalable fácilmente? ¿Querés que
no se te arme lio de dependencias que colisionan con las de otros
proyectos ? Bien, te propongo esta receta.</p>
<div class="section" id="las-herramientas">
<h2>Las herramientas</h2>
<ul class="simple"><li><a class="reference external" href="http://www.virtualenv.org">Virtualenv</a>:  es una herramienta para aislar tu entorno de
desarrollo python. Es muy pero muy útil para evitar conflictos entre las
dependencias de tus distintos proyectos.</li>
<li><a class="reference external" href="http://www.doughellmann.com/projects/virtualenvwrapper/">virtualenvwrapper</a>: es un conjunto de extensiones que
hacen la vida del usuario <em>virtualenv</em> aun más feliz, permitiendo crear
y borrar entornos virtuales, asociarlos a un proyecto, automatizar
tareas al activar o desactivar uno, etc.</li>
<li><a class="reference external" href="http://www.pip-installer.org">pip</a>: es la herramienta moderna, correcta y recomendada
para administrar los paquetes python instalados en tu
sistema/virtualenv. Es un reemplazo de <em>easy_install</em></li>
<li><a class="reference external" href="http://packages.python.org/distribute/">Distribute</a>: es la herramienta moderna y recomendada para
distribuir tu paquete python. Es un fork de <em>setuptools</em> (que es, a su
vez, una mejora sobre el módulo estándar <em>distutils</em>)</li>
<li><a class="reference external" href="https://github.com/stumitchell/skeleton">skeleton</a> es una herramienta que define <em>plantillas</em>
para iniciar un proyecto, generando la estructura básica necesaria. Es
similar a <a class="reference external" href="http://python.org.ar/pyar/PasteScript">PasteScript</a> pero enfocado en esta
tarea concreta, sin dependencias y compatible con Python 3.x</li>
</ul></div>
<div class="section" id="la-receta">
<h2>La receta</h2>
<ol class="arabic"><li><p class="first">Instalá pip:</p>
<pre class="literal-block">
$ sudo apt-get install python-pip
</pre>
<p>o bien directamente:</p>
<pre class="literal-block">
$ sudo curl https://raw.github.com/pypa/pip/master/contrib/get-pip.py | python
</pre>
</li>
<li><p class="first">Instalá virtualenwrapper y skeleton:</p>
<pre class="literal-block">
$ sudo pip install virtualenwrapper
$ sudo pip install git+git://github.com/stumitchell/skeleton.git#egg=skeleton
</pre>
</li>
</ol><div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Notar que <em>skeleton</em> se está instalando desde un <em>fork</em> del proyecto
original (aparentemente desmantenida), que resuelve bugs importantes</p>
</div>
<ol class="arabic" start="3"><li><p class="first">Configurá virtualenvwrapper</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>mkdir ~/.virtualenvs           <span class="c"># acá se van a guardar tus entornos virtuales
</span><span class="nv">$ </span>mkdir ~/proyectos              <span class="c"># acá se van a guardar tus proyectos
</span><span class="nv">$ </span>mkdir ~/.pip_download_cache     <span class="c"># para no bajar paquetes cada vez</span>
</pre>
<p>Luego editá tu <tt class="docutils literal"><span class="pre">~/.bashrc</span></tt> agregando las siguientes líneas</p>
<pre class="code bash literal-block">
<span class="nb">export </span><span class="nv">WORKON_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/.virtualenvs
<span class="nb">export </span><span class="nv">PROJECT_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/proyectos
<span class="nb">export </span><span class="nv">VIRTUALENV_DISTRIBUTE</span><span class="o">=</span><span class="nb">true
export </span><span class="nv">PIP_DOWNLOAD_CACHE</span><span class="o">=</span><span class="nv">$HOME</span>/.pip_download_cache
<span class="nb">source</span> /usr/local/bin/virtualenvwrapper.sh
</pre>
<p>y recargá tus cambios:</p>
<pre class="literal-block">
$ source ~/.bashrc
</pre>
</li>
<li><p class="first">Inicializá tu proyecto. Por ejemplo el proyecto <em>zaraza</em></p>
<pre class="literal-block">
$ mkproject -t package zaraza
</pre>
<p>Se te solicitarán algunos datos (nombre del proyecto, autor,
licencia, etc.) y ¡(casi) listo! Estarás trabajando en tu proyecto
<em>zaraza</em>. Tu prompt se verá así</p>
<pre class="literal-block">
(zaraza)tin@morocha:~/proyectos/zaraza$
</pre>
<p>¿Qué sucedió? Se creó un directorio <tt class="docutils literal">~/proyectos/zaraza</tt> para tu
proyecto, asociado a un virtualenv ubicado en <tt class="docutils literal"><span class="pre">~/.virtualenvs/zaraza</span></tt>.
<strong>skeleton</strong> automáticamente creó una estructura básica de
paquete python en <tt class="docutils literal">~/proyectos/zaraza/src</tt> incluyendo un <tt class="docutils literal">setup.py</tt>
basado en <em>distribute</em>.</p>
</li>
<li><p class="first">Instalá tu paquete en el virtualenv, para poder importarlo desde
cualquier lado:</p>
<pre class="literal-block">
(zaraza) $ cd  ~/proyectos/zaraza/src
(zaraza) $ pip install -e .
</pre>
<p>Esto agrega el directorio de desarrollo de tu proyecto al PYTHONPATH
del virtualenv, de modo que puedes importar <em>zaraza</em> desde cualquier
lado dentro del virtualenv (por ejemplo, cuando hagas una carpeta
<em>src/test</em> al nivel de '/src/zaraza'</p>
</li>
</ol></div>
<div class="section" id="y-ahora">
<h2>¿Y ahora?</h2>
<p>Cada vez que quieras trabajar en tu proyecto <em>zaraza</em> ejecutás:</p>
<pre class="literal-block">
$ workon zaraza
</pre>
<p>Para salir del virtualenv:</p>
<pre class="literal-block">
(zaraza) $ deactivate
</pre>
</div>
<div class="section" id="algunos-tips-mas-a-modo-de-despedida">
<h2>Algunos tips más a modo de despedida</h2>
<p>Virtualenwrapper es totalmente hookeable y extensible. Esta receta
propone usar <em>skeleton</em> (que funciona como plugin de
<a class="reference external" href="http://www.doughellmann.com/projects/virtualenvwrapper.project/">virtualenvwrapper.project</a>)
para crear una estructura de paquete estándar básica, pero hay plugins
para proyectos más específicos. Por ejemplo
<a class="reference external" href="http://www.doughellmann.com/projects/virtualenvwrapper.django/">virtualenwrapper.django</a></p>
<p>El comando <tt class="docutils literal">mkproject</tt> es un wrapper sobre el
comando principal de virtualenvwrapper <tt class="docutils literal">mkvirtualenv</tt>, que acepta muchos
parámetros opcionales. Ejecutá <tt class="docutils literal">mkproject_help</tt> o <tt class="docutils literal">mkvirtualenv <span class="pre">--help</span></tt>
para saber más.</p>
<p>Y ya sabés ...</p>
<div class="figure align-center">
<img alt="http://python-distribute.org/pip_distribute.png" src="http://python-distribute.org/pip_distribute.png"></div>
<hr class="docutils"><blockquote>
Este artículo lo escribí originalmente para el <a class="reference external" href="http://python.org.ar/pyar/Recetario">Recetario de PyAr</a></blockquote>
</div>
        <p>
        
            <a href="posts/creando-un-nuevo-proyecto-python.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/migrando-issues-entre-proyectos-de-bitbucket.html">Migrando issues entre proyectos de Bitbucket</a>
        <small>  
             <span class="timeago" title="2012-11-10 00:09:24">2012-11-10 00:09:24</span>
        </small></h1>
        <!-- title: Migrando issues entre proyectos de Bitbucket -->
<!-- slug: migrando-issues-entre-proyectos-de-bitbucket -->
<!-- date: 2012/11/10 0:09:24 -->
<!-- tags: python, migraciones, scripts -->
<!-- link: -->
<!-- description: -->
<p>Hace un tiempo conté <a class="reference external" href="posts/de-mercurial-a-git-limpieza.html">como migré un repositorio Mercurial a Git</a> .
Se trataba de un proyecto hospedado en <a class="reference external" href="http://bitbucket.org">Bitbucket</a> y para cambiar
de DVCS tuve que crear un proyecto nuevo, que tambien hospedamos
allí porque somos pobretones y nos da repos privados gratis.
En la mudanza se me quedaron varios <em>issues</em> que necesitaba migrar. Y <a class="reference external" href="https://bitbucket.org/site/master/issue/1642/allow-moving-tickets-over-to-another">no era el único</a>.</p>
<p>Buscando un rato encontré scriptcitos para migrar <a class="reference external" href="https://github.com/sorich87/github-to-bitbucket-issues-migration">desde</a> o <a class="reference external" href="https://gist.github.com/3778347">hacia</a> GitHub
pero no había para migrar entre proyectos de Bitbucket, algo bastante común
desde que empezaron a ofrecer soporte Git.</p>
<p>Decidí entonces que debía hacer mi propio scriptcito migrador. La cosa se
complicaba porque <a class="reference external" href="https://github.com/Sheeprider/BitBucket-api">el</a>
<a class="reference external" href="https://github.com/ericof/python-bitbucket">par</a> de bibliotecas python
que interactuan con la API de Bitbucket no tenian, hasta el momento, soporte
para "postear" <em>issues</em></p>
<p>Pero no hay darse por vencido: se me ocurrió mirar el par de forks de cada
proyecto y encontré <a class="reference external" href="https://github.com/davidmpaz/BitBucket-api/commit/e7d727f0a340ca9f2c131b04bd72d7cf5e4960dc">justo lo que estaba buscando</a>.</p>
<p>Entonces bastó con instalar el fork de David Paz Reyes</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>pip install git+https://github.com/davidmpaz/BitBucket-api.git
</pre>
<p>he hice un script que migra todo los issues en estado <em>new</em>
del repo original (<tt class="docutils literal">gpec</tt>) al nuevo (<tt class="docutils literal">gpec</tt>) y los potenciales comentarios que tenga.
Como el autor  se pierde (dado que el nuevo quedará publicado con mi usuario)
agrego un comentario avisando que es un <em>issue migrado</em>.</p>
<pre class="code python literal-block">
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">bitbucket</span> <span class="kn">import</span> <span class="n">bitbucket</span>

<span class="n">gpec</span> <span class="o">=</span> <span class="n">bitbucket</span><span class="o">.</span><span class="n">Bitbucket</span><span class="p">(</span><span class="s">'tin_nqn'</span><span class="p">,</span> <span class="s">'***'</span><span class="p">,</span> <span class="s">'gpec'</span><span class="p">)</span>
<span class="n">gpec3</span> <span class="o">=</span> <span class="n">bitbucket</span><span class="o">.</span><span class="n">Bitbucket</span><span class="p">(</span><span class="s">'tin_nqn'</span><span class="p">,</span> <span class="s">'***'</span><span class="p">,</span> <span class="s">'gpec3'</span><span class="p">)</span>

<span class="c"># request original ISSUES</span>
<span class="n">_</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">gpec</span><span class="o">.</span><span class="n">get_issues</span><span class="p">()</span>

<span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s">'issues'</span><span class="p">][:]:</span>
    <span class="n">original_id</span> <span class="o">=</span> <span class="n">issue</span><span class="p">[</span><span class="s">'local_id'</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">issue</span><span class="p">[</span><span class="s">'status'</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'new'</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="c"># and post to the new repo</span>
    <span class="n">ok</span><span class="p">,</span> <span class="n">new_issue</span> <span class="o">=</span> <span class="n">gpec3</span><span class="o">.</span><span class="n">add_issue</span><span class="p">(</span><span class="o">**</span><span class="n">issue</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">'Fail migrating #</span><span class="si">%d</span><span class="s">'</span> <span class="o">%</span> <span class="n">original_id</span>
        <span class="k">continue</span>

    <span class="n">new_id</span> <span class="o">=</span> <span class="n">new_issue</span><span class="p">[</span><span class="s">'local_id'</span><span class="p">]</span>

    <span class="k">print</span> <span class="s">'Migrated #</span><span class="si">%d</span><span class="s"> as #</span><span class="si">%d</span><span class="s"> in the new project'</span> <span class="o">%</span> <span class="p">(</span><span class="n">original_id</span><span class="p">,</span> <span class="n">new_id</span><span class="p">)</span>

    <span class="c"># add a comment to mark the migration</span>
    <span class="n">who</span> <span class="o">=</span> <span class="n">issue</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'reported_by'</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
    <span class="n">who</span> <span class="o">=</span> <span class="n">who</span><span class="p">[</span><span class="s">'username'</span><span class="p">]</span> <span class="k">if</span> <span class="n">who</span> <span class="k">else</span> <span class="s">'anonymous'</span>
    <span class="n">gpec3</span><span class="o">.</span><span class="n">add_issue_comment</span><span class="p">(</span><span class="n">new_id</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="s">"Issue migrated from the original repo. "</span>
            <span class="s">"Was #</span><span class="si">%d</span><span class="s"> reported by </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="n">original_id</span><span class="p">,</span> <span class="n">who</span><span class="p">))</span>

    <span class="c"># migrate comments</span>
    <span class="n">result</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="n">gpec</span><span class="o">.</span><span class="n">get_issue_comments</span><span class="p">(</span><span class="n">original_id</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comments</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span><span class="p">[</span><span class="s">'content'</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="n">gpec3</span><span class="o">.</span><span class="n">add_issue_comment</span><span class="p">(</span><span class="n">new_id</span><span class="p">,</span> <span class="o">**</span><span class="n">c</span><span class="p">)</span>
</pre>
<p>¡Disfruten!</p>
        <p>
        
            <a href="posts/migrando-issues-entre-proyectos-de-bitbucket.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/ext4-superblock-failure-y-la-cola-del-diablo.html">Ext4 superblock failure y la cola del Diablo</a>
        <small>  
             <span class="timeago" title="2012-10-26 02:24:46">2012-10-26 02:24:46</span>
        </small></h1>
        <!-- title: Ext4 superblock failure y la cola del Diablo -->
<!-- slug: ext4-superblock-failure-y-la-cola-del-diablo -->
<!-- date: 2012/10/26 02:24:46 -->
<!-- tags: -->
<!-- link: -->
<!-- description: e -->
<p>Domingo, ciudad de Guayaquil, todo dispuesto para salir a
conocer una ciudad que en las guías de viaje suena intererante y bonita.
Se me ocurre prender la compu para ver si ese email que mandé la noche
anterior, recién llegado después de 14 horas de viaje
(5 de espera en el aeropuerto de Santiago) y deseando únicamente
ducha y colchón, había sido contestado.</p>
<p><em>"No pusheé"</em>, fué lo primero que pensé, o me lo dije, en voz inaudible,
como eufemismo de un gran insulto y síntesis de <em>"Martincito querido,
ya sabés que el booteo está tardando mucho, el material para el taller_ que
tenés que dar mañana está en esa computadora y tiene al menos 10 horas
de trabajo offline que está en la última versión online: no podés ser tan
pelotudo y tener tan mal orto a la vez</em>". Mi voz interior sí que sabe
resumir.</p>
<p>Por suerte, no perdí la calma. Apreté el 1 en el teléfono: <em>"sí señor",  el
Bussiness Center queda en el 4 piso"</em>. Ahí fui y habia computadoras con
las que pude contactarme con Houston.</p>
<p>Grulic, <a class="reference external" href="https://twitter.com/perrito666">Perrito</a>,
<a class="reference external" href="http://verdumariano.com.ar/">Mariano</a>, Rudi, y especialmente
<a class="reference external" href="http://blog.ontrackdatarecovery.es/conoce-al-ingeniero-ernesto-lobo/">mi cuñado que trabaja en Ontrack</a>
y era algo así como un Messi sentado en mi banco de suplentes
para este partido que yo no hubiese querido jugar, fueron los primeros
con quienes me comuniqué.</p>
<p>Mandé este mensaje:</p>
<blockquote>
<p>Gente, les mando una de Murphy y el diablo y toda la mala leche junta.
Estoy en Ecuador invitado a dar un curso-taller de Python y Django.</p>
<p>Rodo venía fantastico , hasta que hoy enciendo la laptop y no y no entra el sistema operativo!.</p>
<p>Entro en modo recuperacion (ubuntu 11.10) y se clava en el <tt class="docutils literal">fsck</tt>
hasta que me aparece un menucito que me deja entrar a una consola root.
Lo peor sucedió <tt class="docutils literal">/home/</tt> no monta , pero el <tt class="docutils literal">/</tt>
parece estar sano. Ambas son una particion <tt class="docutils literal">ext4</tt></p>
<p>Si intento montar a mano o un fsck, el output dice muchas cosas que
suenan mal pero no tengo puta idea qué significan:</p>
<pre class="literal-block">
STATUS { DRDY }
ERROR { UNC }
configured for UDMA/133
failed command READ DMA
exception Emask 0x0 Sact 0x0 Serr 0x0 action 0x0
res 51/40... Emask 0x9 (media error)
</pre>
<p>Por favor, iluminenmé sobre cómo proceder.</p>
</blockquote>
<p>Ernesto contestó. Primero intentar hacer un un live-usb con algunas
herramientas de diagnostico: <a class="reference external" href="http://ubuntu-rescue-remix.org/">Ubuntu-rescue-remix</a>
podría funcionar, pero las maquinas del Bussiness center no me dejan
instalar algun <a class="reference external" href="http://www.pendrivelinux.com/universal-usb-installer-easy-as-1-2-3/">programita</a>
para pasar la ISO al pendrive.</p>
<p>Empiezo a deseperar ya pensar si no conviene aprovechar el tiempo que me llevará
intentar un salvataje con alta probabilidad de fracaso para rehacer el
trabajo inaccesible.</p>
<p>Desactivar journal, no. Forzar montado, no. No se qué otra cosa, no.</p>
<p>Ernesto pregunta si me animo a ir por el camino duro.</p>
<blockquote>
Cómo estás de fresco ara leer hexadecimal ? <tt class="docutils literal">hexdump</tt> y <tt class="docutils literal">dd</tt>, la navaja suiza.
que necesitamos</blockquote>
<p>Intentamos algunas cosas, calculadora en mano,
pero la mayoría de los intentos de acceso al disco
caen en el mismo bucle de errores horribles. Mucho calor en Guayaquil.</p>
<p>Le digo a Ernesto (domingo, dia de descanso) que no se preocupe, que intentemos
eso último que se le ocurrió pero que si no funciona voy a ponerme a trabajar
de nuevo. Mientras tanto, el Dios en el que no creo me pone
<a class="reference external" href="http://linuxexpresso.wordpress.com/2010/03/31/repair-a-broken-ext4-superblock-in-ubuntu/">este link</a>
en el camino de resultados de Google.</p>
<p>"Ernesto, prabamos esto?" y no alcanzó a contestar
antes de que esté poniendo los primeros comandos</p>
<pre class="code bash literal-block">
<span class="nv">$ </span>sudo mke2fs -n /dev/sda3

Superblock backups stored on blocks:
32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208
</pre>
<p>Me la juego con el primer backup:</p>
<pre class="code bash literal-block">
sudo e2fsck -b 32768 /dev/sda3
</pre>
<p>Cientos de  <tt class="docutils literal">Y</tt> <tt class="docutils literal">Enter</tt> para mensajes estilo <em>"está roto, desea repararlo?"</em>
(no había una opción "Sí a todo", como si uno fuese capaz de arrepentirse
a mitad de camino)</p>
<p>Anduvo. Uff. Dos simples comandos.
El Ingeniero Lobo festeja desde Londres, Skype mediante,
que podía volver a limpiar su moto sin quedar mal con su cuñado con mala
pata. Me dijo antes:</p>
<blockquote>
Si no hubiese sido una situadion del tipo <em>mañana
ya no me sirven los datos</em> yo te hubiera  recomendado en contra
de herramienta como <tt class="docutils literal">e2fsck</tt>. Esos programas sólo se encargan
de asegurar que el filesystem esté íntegro, pero si para eso tienen
que cortarlo a la mitad lo hacen sin dudar.
Son como doctores de guerra: te dejan vivo, pero sin una pierna y un
brazo.</blockquote>
<p>Querido Guayaquil: prometo visitar tu Malecón la próxima,
<strong>push</strong> por adelantado.</p>
        <p>
        
            <a href="posts/ext4-superblock-failure-y-la-cola-del-diablo.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/notas-rapidas-de-una-mudanza.html">Notas rápidas de una mudanza</a>
        <small>  
             <span class="timeago" title="2012-10-14 19:23:44">2012-10-14 19:23:44</span>
        </small></h1>
        <!-- title: Notas rápidas de una mudanza -->
<!-- slug: notas-rapidas-de-una-mudanza -->
<!-- date: 2012/10/14 19:23:44 -->
<!-- tags: nikola, spip, migration tools -->
<!-- link: -->
<!-- description: -->
<p>Hace unos días abría este espacio prometiendo migrar contenidos y
tratar de que se vea un poco más bonito.</p>
<p>Este post incluye algunas notas sobre lo que he hecho hasta el momento.</p>
<div class="section" id="github-nikola">
<h2>Github ♥ Nikola</h2>
<p>Este blog que estás leyendo está hospedado en <a class="reference external" href="http://pages.github.com">Github Pages</a> ,
el servicio de hosting gratuito de contenido estático que ofrece Github.</p>
<p>A diferencia de cuando se usa Gh-pages para proyectos, donde se sirve
el contenido del branch <em>gh-page</em> del proyecto en cuestión,
para usar gh-pages por usuario hay que crear
un repo llamado <em>&lt;username&gt;</em>.github.com (donde <em>&lt;username&gt;</em> es el tuyo)
y lo que sirve en <a class="reference external" href="http:/">http:/</a>/&lt;username&gt;.github.com es directamente el branch
<em>master</em> (<a class="reference external" href="https://help.github.com/articles/user-organization-and-project-pages">referencia</a>)</p>
<p>Por este motivo creé otro branch (que sin mucha imaginación denominé
<a class="reference external" href="https://github.com/mgaitan/mgaitan.github.com/tree/writing">writing</a> )
donde tengo todo el mi "proyecto" hecho con Nikola</p>
<p>Allí escribo, intento mejorar mi <a class="reference external" href="https://github.com/mgaitan/mgaitan.github.com/tree/writing/themes/custom">theme</a>, y corro <tt class="docutils literal">nikola build</tt>.</p>
<p>El branch master es el de deploy y sirve todo lo que haya en la carpeta
<tt class="docutils literal">output/</tt> del branch <tt class="docutils literal">writing</tt>. Para hacer <a class="reference external" href="http://stackoverflow.com/a/10591668">esto</a> hay que ir a <em>master</em>,
borrar todo y leer desde el árbol del otro branch con <tt class="docutils literal"><span class="pre">read-tree</span></tt></p>
<pre class="literal-block">
git checkout master
git rm *    # sólo la primera vez
git read-tree writing:output
git commit -m 'deploying last build'
git push
</pre>
</div>
<div class="section" id="migrando-desde-spip">
<h2>Migrando desde Spip</h2>
<p>Uno de los motivos que me llevaron a migrar desde <a class="reference external" href="http://www.spip.net">Spip</a> es que el markup
que usa es <em>ad hoc</em> y muy feo. Algo así</p>
<pre class="literal-block">
{{{ Un intertítulo }}}

Esto es {{negrita}} y este [mi twitter-&gt;http://twitter.com/tin_nqn_]
</pre>
<p>Hasta ahí no se ve tan mal, pero es muy limitado cuando se trata de mostrar
código, necesario en todo blog mas o menos técnico.</p>
<p>Para migrar esquivé la idea de convertir el markup de spip y opté por un
scrapping, limpieza y conversión a restructuredText usando el mágico
<a class="reference external" href="http://johnmacfarlane.net/pandoc">Pandoc</a> (y la ayuda de PyQuery)</p>
<p>El script que hice está
<a class="reference external" href="https://github.com/mgaitan/mgaitan.github.com/blob/writing/tools/spip_converter.py">acá</a>
. No es perfecto, pero está lo importante: contenidos, imágenes, adjuntos,
convertido a restructuredText bastante decente que mejoraré poco a poco
a mano.</p>
</div>
<div class="section" id="estilos">
<h2>Estilos</h2>
<p>Es mentira que a los ñoños no nos gustan las cosas (los blogs, entre otras)
que se ven bonitos. Sucede, en realidad, que la mayoría de las veces no
venimos con <em>esa</em> habilidad y el esfuerzo que nos implica intentarlo
preferimos ponerlo en otra cosa. No gusta, pero no es lo más importante.</p>
<p>No obstante, yo quiero que este espacio sea lindo y legible. Y como hay
muchos otros ñoños con sitios lindos y legibles que son tan amables de
compartir sus estilos (y existe <a class="reference external" href="http://twitter.github.com/bootstrap">bootstrap</a>, claro) voy a ir intentándolo,
incrementalmente.</p>
<p>Por ahora tomé ideas y CSS de <a class="reference external" href="http://stevelosh.com">stevelosh.com</a> <a class="footnote-reference" href="posts/notas-rapidas-de-una-mudanza.html#id3" id="id1">[1]</a> y de la documentación
de <a class="reference external" href="http://flask.pocoo.org/docs/">Flask</a> <a class="footnote-reference" href="posts/notas-rapidas-de-una-mudanza.html#id4" id="id2">[2]</a> basado en el theme <em>Readable</em> de <a class="reference external" href="http://bootswatch.com/">bootswatch.com</a></p>
</div>
<div class="section" id="disqus">
<h2>Disqus</h2>
<p>El blog viejo usaba <a class="reference external" href="http://disqus.com">Disqus</a>, con un <a class="reference external" href="http://mgaitan.github.com/posts/disqus-para-spip.html">plugin</a> que hice hace algun tiempo.
Para migrar los comentarios utilicé el método de subir un CSV con
el formato que genera el mismo script de migración:</p>
<pre class="literal-block">
URL_POST_X_OLD, URL_POST_X_NEW
URL_POST_Y_OLD, URL_POST_Y_NEW
</pre>
<p>En cuestión de minutos los (pocos) comentarios estaban migrados.</p>
</div>
<div class="section" id="redireccion">
<h2>Redirección</h2>
<p>Como mantuve el slug de los viejos artículos, una redirección 301
via .htaccess redirige del viejo blog al nuevo:</p>
<pre class="literal-block">
# nqnwebs.com blog rules
RewriteCond %{HTTP_HOST} ^nqnwebs [nc]
RewriteRule ^blog[/]?$ http://mgaitan.github.com/ [R=301]
RewriteRule ^blog/article/(.*)$ http://mgaitan.github.com/posts/$1.html [R=301]
</pre>
<p>¿Cómo se va viendo?</p>
<table class="docutils footnote" frame="void" id="id3" rules="none"><colgroup><col class="label"><col></colgroup><tbody valign="top"><tr><td class="label"><a class="fn-backref" href="posts/notas-rapidas-de-una-mudanza.html#id1">[1]</a></td><td><a class="reference external" href="https://bitbucket.org/sjl/stevelosh/src/6432040d5154/LICENSE?at=default">https://bitbucket.org/sjl/stevelosh/src/6432040d5154/LICENSE?at=default</a></td></tr></tbody></table><table class="docutils footnote" frame="void" id="id4" rules="none"><colgroup><col class="label"><col></colgroup><tbody valign="top"><tr><td class="label"><a class="fn-backref" href="posts/notas-rapidas-de-una-mudanza.html#id2">[2]</a></td><td><a class="reference external" href="https://github.com/mitsuhiko/flask-sphinx-themes/blob/master/LICENSE">https://github.com/mitsuhiko/flask-sphinx-themes/blob/master/LICENSE</a></td></tr></tbody></table></div>
        <p>
        
            <a href="posts/notas-rapidas-de-una-mudanza.html#disqus_thread">Comments</a>
        
        </p></div>
    
    <div>
<ul class="pager"><li class="next">
        <a href="index-1.html">Posts anteriores  →</a>
    </li>
  
</ul></div>
    
        <script type="text/javascript"> var disqus_shortname = 'nqnwebs'; (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = 'http://' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script><!--End of body content--><hr><small>Contents © 2012 Martín Gaitán</small>
        </div>
    </div>
    <div class="row">
        <div class="span10 offset1" id="sidebar">
            <!--Sidebar content-->
            <ul class="inline"><li><a href="http://www.textosypretextos.com.ar" title="Mi otro blog">Textos y pretextos</a>
                    /
                </li><li><a href="http://nikola.ralsina.com.ar">Powered by Nikola</a>
                /
            </li><li> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
                        <img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/2.5/ar/80x15.png"></a>
            </li></ul><!--End of sidebar content--></div>
    
    
    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script></div></div></div></div></body></html>