<!DOCTYPE html><html lang="es"><head><meta charset="utf-8"><meta name="title" content="tin_nqn (posts antiguos página 6) | &gt;&gt;&gt; me.geek.post()"><meta name="description" content="&gt;&gt;&gt; me.geek.post()"><meta name="author" content="Martín Gaitán"><title>tin_nqn (posts antiguos página 6) | &gt;&gt;&gt; me.geek.post() </title><!-- Le styles --><link href="assets/css/bootstrap.css" rel="stylesheet" type="text/css"><link href="assets/css/bootstrap-responsive.css" rel="stylesheet" type="text/css"><link href="assets/css/rst.css" rel="stylesheet" type="text/css"><link href="assets/css/code.css" rel="stylesheet" type="text/css"><link href="assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="assets/css/theme.css" rel="stylesheet" type="text/css"><link href="http://fonts.googleapis.com/css?family=OFL+Sorts+Mill+Goudy+TT:regular,italic" rel="stylesheet" type="text/css"><link href="assets/css/custom.css" rel="stylesheet"><script src="assets/js/jquery-1.7.2.min.js" type="text/javascript"></script><script src="assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script src="assets/js/jquery.timeago.js" type="text/javascript"></script><script src="assets/js/jquery.timeago.es.js" type="text/javascript"></script><script>

            jQuery(document).ready(function() {
              jQuery("span.timeago").timeago();
            });

        </script><!-- Le HTML5 shim, for IE6-8 support of HTML5 elements --><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS (es)" href="rss.xml"></head><body>
<div class="container-fluid" id="container">
    <div class="row-fluid" id="titlerow">

    <div class="span10 offset1" id="titlecolumn">
    <!-- Banner-like substance !-->
        <div class="titlebox span3">
        <h1 id="blog-title">
            <a href=".">tin_nqn</a>
        </h1>
        <h6 id="blog-description">&gt;&gt;&gt; me.geek.post()</h6>

        
        
        
        </div>
    <div id="menu" class="span7 offset1">
      <ul class="inline"><li><a href="archive.html">Archivos</a>
                 / 
            
                </li><li><a href="categories/index.html">Categorías</a>
                 / 
            
                </li><li><a href="about.html">Sobre mí</a>
                 / 
            
                </li><li><a href="charlas.html">Charlas</a>
                
            
        </li></ul></div>
    <!-- End of banner-like substance !-->
    <div class="row" id="contentrow">
        <div class="span10 offset1" id="contentcolumn">
            <!--Body content-->
            
    
        <div class="postbox">
        <h1><a href="posts/backup-selectivo-de-tablas-mysql.html">Backup selectivo de tablas Mysql</a>
        <small>  
             <span class="timeago" title="2009-03-31 09:37:49">2009-03-31 09:37:49</span>
        </small></h1>
        <p>Un comando muy práctico para hacer backups de una base de datos MySQL es
<em>mysqldump</em>.</p>
<pre class="literal-block">
mysqldump -h SERVIDOR -u USUARIO -pPASSWORD base_de_datos &gt; backup.sql
</pre>
<p>Eso hace un backup completo de la base <em>base_de_datos</em> (incluyendo la
creación de todas las tablas.</p>
<p>Para restaurar ese backup se hace directamente inyectando el sql al
interprete de mysql.</p>
<pre class="literal-block">
mysql -h SERVIDOR -u USUARIO -pPASSWORD base_de_datos
</pre>
<div class="section" id="respaldar-solo-algunas-tablas-de-la-base">
<h2>Respaldar sólo algunas tablas de la base</h2>
<p>A menudo tenemos multiples sistemas instalados sobre la misma base de
datos, Si sólo queremos respaldar algunas tablas bastaría enumerar las
tablas luego del nombre de la base de datos</p>
<pre class="literal-block">
mysqldump -h SERVIDOR -u USUARIO -pPASSWORD base_de_datos  tabla1 tabla2 &gt; backup.sql
</pre>
<p>Pero si estas tablas son muchas, es engorroso definirlas una por una.
Por suerte, en general, un prefijo asocia todas las tablas de un
sistema.</p>
<p>En ese caso, se puede usar el siguiente compando que respalda todas las
tablas con un prefijo, En este ejemplo, las que comienzan con "spip_":</p>
<pre class="literal-block">
mysql -h SERVIDOR -u USUARIO -pPASSWORD base_de_datos  -e 'show tables like "spip_%"' | grep -v Tables_in | xargs mysqldump -h SERVIDOR -u USUARIO -pPASSWORD base_de_datos &gt; backup.sql
</pre>
</div>
        <p>
        
            <a href="posts/backup-selectivo-de-tablas-mysql.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/lorem-ipsum-para-spip.html">Lorem Ipsum para Spip</a>
        <small>  
             <span class="timeago" title="2009-03-26 20:39:24">2009-03-26 20:39:24</span>
        </small></h1>
        <p><a class="reference external" href="http://es.wikipedia.org/wiki/Lorem_ipsum">Lorem ipsum</a> es el texto
que se usa habitualmente en diseño gráfico en demostraciones de
tipografías o de borradores de diseño para probar el diseño visual antes
de insertar el texto final.</p>
<p>Cuando estamos desarrollando necesitamos ver cómo quedará el contenido,
y debemos recurrir a un <em>copy &amp; paste</em> de caulquier cosa que tengamos a
mano.</p>
<p>La ventaja de un <em>Lorem Ipsum</em> sobre otros textos, es que este tiene una
distribución del largo de las palabras bastante natural de las palabras
lo que en textos largos queda mucho mejor que repetir un mismo fragmento
una y otra vez.</p>
<p>Hay muchos <a class="reference external" href="http://www.lipsum.com/">generadores de texto Lorem Ipsum</a>
en internet, pero lo podemos hacer aún más fácil.</p>
<div class="section" id="un-lorem-ipsum-automatico">
<h2>Un Lorem Ipsum automático</h2>
<p>Con la ayuda del plugin <a class="reference external" href="http://sanderkorvemaker.nl/jquery/jLorem.php">jQuery Lorem
Ipsum</a> de Sander Korve
hice un modelo (instalable como plugin) que permite insertar un texto
del tamaño que queramos (por omisión, de 4 párrafos).</p>
<p>Podés bajarlo desde acá:</p>
<table border="1" class="docutils"><colgroup><col width="100%"></colgroup><tbody valign="top"><tr><td><a class="reference external" href="downloads/loremipsum.zip">|image1|</a></td>
</tr><tr><td>Lorem Ipsum Plugin version 0.2</td>
</tr></tbody></table><p>O por SVN:</p>
<pre class="literal-block">
svn checkout svn://zone.spip.org/spip-zone/_plugins_/_test_/loremipsum
</pre>
</div>
<div class="section" id="instalacion">
<h2>Instalación</h2>
<p>La instalación es igual que con la de cualquier plugin: descomprimirlo
en la carpeta <em>/plugins</em> y activarlo.</p>
<p>Requiere además que los esqueletos tengan la baliza <tt class="docutils literal">#INSERT_HEAD</tt>
dentro del header, ya que allí se incluirá el javascript necesario para
su funcionamiento.</p>
</div>
<div class="section" id="funcionamiento-basico">
<h2>Funcionamiento básico</h2>
<p>La inclusión de un <em>Lorem Ipsum</em> se basa en el modelo <em>lorem.html</em>
incluído con el plugin, por lo que hay dos maneras de llamarlo:</p>
<p><img alt="-" src="posts/local/cache-vignettes/L8xH11/puce-32883.gif"> En el cuerpo (texto, descripción, etc) de un artículo: <tt class="docutils literal">&lt;lorem&gt;</tt></p>
<p><img alt="image3" src="posts/local/cache-vignettes/L8xH11/puce-32883.gif"> Predefinido en un esqueleto: <tt class="docutils literal">#MODELE{lorem}</tt></p>
<p>¡y listo!</p>
</div>
<div class="section" id="parametros">
<h2>Parámetros</h2>
<p>El modelo acepta algunos parámetros para configurar la longitud del
texto. Por ejemplo <tt class="docutils literal">&lt;lorem5&gt;</tt> creará 5 párrafos.</p>
<p>Pero también se puede especificar más datos:</p>
<p><img alt="image4" src="posts/local/cache-vignettes/L8xH11/puce-32883.gif"><strong>type</strong>: permite especificar que tipo de resultado se quiere.
Las opciones válidas son <strong>paragraphs</strong>, <strong>words</strong> o <strong>characters</strong> para
párrafos, palabras o characteres. Así: creará un texto de 25 palabras.
El valor por omisión es <strong>paragraphs</strong>.</p>
<p><img alt="image5" src="posts/local/cache-vignettes/L8xH11/puce-32883.gif"><strong>amount</strong>: Es lo mismo que el ID pasado al modelo: es lo mismo
que . Por ejemplo <tt class="docutils literal"><span class="pre">[(#MODELE{lorem}{amount=5})]</span></tt>
[<a class="reference external" href="blog/article/lorem-ipsum-para-spip#nb1">1</a>].</p>
<p><img alt="image6" src="posts/local/cache-vignettes/L8xH11/puce-32883.gif"><strong>ptags</strong>: Permite agregar las etiquetas &lt;code&lt;&gt;P&lt;&gt;/code&gt;
alrededor de cada párrafo. Los valores aceptados son <strong>true</strong> o
<strong>false</strong>. Por omisión es <strong>true</strong>.</p>
</div>
<div class="section" id="una-astucia">
<h2>Una astucia</h2>
<p>Una forma de mostrar contenido en un artículo (o cualquier elemento) sin
tener que editar cada artículo sólo para poner <tt class="docutils literal">&lt;lorem&gt;</tt> es invocar el
modelo siempre y cuando no exista contenido en la baliza</p>
<p>Por ejemplo [<a class="reference external" href="blog/article/lorem-ipsum-para-spip#nb2">2</a>]:</p>
</div>
        <p>
        
            <a href="posts/lorem-ipsum-para-spip.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/auto-podcast.html">Auto Podcast</a>
        <small>  
             <span class="timeago" title="2009-03-21 12:53:03">2009-03-21 12:53:03</span>
        </small></h1>
        <p><a class="reference external" href="http://www.efectotabano.com.ar">Efecto Tábano</a> es el programa radial
de mi amigo Fernando Barraza. Objetivamente, uno de los mejores
programas radiales de Argentina.</p>
<p>Lamentablemente, desde que me vine a Córdoba tuve que conformarme con
los fragmentos de entrevistas o especiales que Fernando subía a la web.
Pero ahora que la <a class="reference external" href="http://fm1037online.com/">Radio Calf-UNC</a> está
online, la alegría está completa.</p>
<p>El único problema que queda es que no todos los días tengo el tiempo de
escucharlo de 16 a 18hs, Necesitaba grabarlo para escucharlo offline.</p>
<p>Bien podría haber hecho esto localmente pero como al sitio lo administro
yo, dije... ¿por qué no grabar el programa directamente desde el
servidor, y que cualquiera pueda bajarlo cuando quiera?</p>
<p>Aquí está mi podcaster automático para Efecto Tábano.</p>
<div class="section" id="la-idea">
<h2>La idea</h2>
<p>Todo se basa en el glorioso <a class="reference external" href="http://mplayerhq.hu">Mplayer</a>, Mplayer es
capaz de reproducir casi cualquier formato en streaming.</p>
<p>Por supuesto, no habrá sonido en esa "reproducción" sobre el servidor,
pero lo que queremos es la info para grabarla.</p>
<p>En vez de enviarla a la placa de sonidos, la información cruda (el
sonido WAV) lo enviamos a un archivo fifo desde donde
<a class="reference external" href="http://lame.sourceforge.net/">lame</a> obtendrá su fuente de datos para
comprimir a MP3 <em>on the fly</em>.</p>
<p>Todo esto, claro, se ejecutará al horario del programa (y durante el
tiempo que se indique, en este caso casi 2 horas) mediante una tarea
<a class="reference external" href="http://es.wikipedia.org/wiki/Cron_(Unix)">cron</a></p>
</div>
<div class="section" id="instalando-lo-necesario">
<h2>Instalando lo necesario</h2>
<p>Como anticipé, hace falta mplayer y lame. Estos programas en general no
se encuentran en el servidor (por ejemplo
<a class="reference external" href="http://www.dreamhost.com/r.cgi?150740">Dreamhost</a>) así que hay que
instalarlos. Como tampoco somos root (la gran mayoría de las veces)
habrá que compilarlos desde las fuentes e instalarlos a nivel usuario.</p>
<p>primero crear, si no existiése, un directorio /bin donde irán nuestros
programas.</p>
<pre class="literal-block">
mkdir bin
chmod 775 bin
</pre>
<p><strong>Mplayer y mencoder</strong></p>
<pre class="literal-block">
wget http://www3.mplayerhq.hu/MPlayer/releases/codecs/essential-20061022.tar.bz2
bunzip2 essential-20061022.tar.bz2
tar -xf essential-20061022.tar
mv essential-20061022 $HOME/lib
wget http://www3.mplayerhq.hu/MPlayer/releases/MPlayer-1.0rc1.tar.bz2
bunzip2 MPlayer-1.0rc1.tar.bz2
tar -xf MPlayer-1.0rc1.tar
cd MPlayer-1.0rc1
./configure --prefix=$HOME --codecsdir=$HOME/lib/essential-20061022
make
make install
</pre>
<p><strong>LAME</strong></p>
<pre class="literal-block">
wget http://nchc.dl.sourceforge.net/sourceforge/lame/lame-3.97.tar.gz
tar -zxvf lame-3.97.tar.gz
cd lame-3.97
./configure "--prefix=$HOME" "--enable-shared"
make
make install
</pre>
<p>Con eso ya tendríamos los programas necesarios en <strong>./bin</strong></p>
</div>
<div class="section" id="el-script-podcaster-efectotabano-sh">
<h2>El script podcaster-efectotabano.sh</h2>
<pre class="literal-block">
#!/bin/sh
#
# recorder — wrapper to pull remote audio stream and convert contents
# to mp3

# Path and arguments to lame (mp3 encoder)
lame="$HOME/bin/lame -S -b 32 -m m"

# Path and arguments to mplayer (stream decoder)
mplayer="$HOME/bin/mplayer -quiet"

# Where to put the output files
odir="$HOME/efectotabano.com.ar/podcast"

showname="efectotabano-`date +%Y-%m-%d`"
duration="6660"
url="http://78.159.108.83:8690/"

fifo="${showname}_fifo"
ofile="$odir/${showname}.mp3"

#- end config ----------------------------------------------------

mkfifo $fifo
$lame $fifo $ofile &amp;
$mplayer  -vc null -vo null -ao pcm:file=$fifo $url &amp;

sleep 5
pids=`ps auxww | grep $fifo | awk '{print $duration}'`

sleep `echo ${duration} | bc`

kill $pids
rm $fifo
</pre>
<p>La primera parte permite configurar las rutas y parámetros de los
programas a usar, así como el formato y destino del mp3 de salida.</p>
<p>En este caso los parámetros de lame indican que se grabará a 32kbps en
mono.</p>
<p>Los mp3 de salida irán a <a class="reference external" href="http://www.efectotabano.com.ar/podcast/">este
destino</a></p>
<p>Este script se ejecuta de lunes a viernes a las 12:09 hora del servidor
(16:09 en argentina) y durante 6660 segundo, de modo que termina
tentativamente junto con la finalización del programa.</p>
<p>Para configurar la tarea en cron ejecutar <strong>crontab -e</strong>. La tarea a
agregar luce así:</p>
<pre class="literal-block">
09 12 * * 1-5 ~/bin/podcaster-efectotabano.sh
</pre>
<p>Eso es todo. Todos los días, de lunes a viernes tendré mi programa para
descargar.</p>
</div>
<div class="section" id="to-do">
<h2>TO DO</h2>
<p>Por supuesto, para que esto sea un
<a class="reference external" href="http://es.wikipedia.org/wiki/podcast">podcast</a> le falta la
sindicación. Por lo tanto, habría que agregar la tarea de injectar
información pertinente en una base de datos del cual generar el XML de
sindicación.</p>
</div>
        <p>
        
            <a href="posts/auto-podcast.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/variar-o-no-variar-esa-es-la.html">Variar o no variar, esa es la cuestión</a>
        <small>  
             <span class="timeago" title="2009-03-15 20:03:38">2009-03-15 20:03:38</span>
        </small></h1>
        <p>Hace algunos días, en
<a class="reference external" href="http://listes.rezo.net/mailman/listinfo/spip-es">spip-es</a> se planteó
la duda de cómo controlar una cabecera diferente para algunas secciones
en particular.</p>
<p><a class="reference external" href="http://archives.rezo.net/spip-es.mbox/200903.mbox/%3C29008.88.7.114.173.1236164746.squirrel@correo.nodo50.org%3E">Xabi
aportó</a>
la solución canónica, que es crear esqueletos ad-hoc para cada sección
difente, valiendose de los esqueletos con forma <em>rubrique-X.html</em> (donde
X es el ID de la sección).</p>
<p>Esto se describe en el apartado "<a class="reference external" href="http://www.spip.net/es_article2257.html">Para ir más
lejos</a>" de la documentación.</p>
<p>En este caso particular, sólo se quería mostrar el logo en la cabecera
para algunas secciones. El problema es que las secciones "diferentes"
serían iguales entre sí, pero invocando distintos esqueletos. Esto
contradice el <a class="reference external" href="http://es.wikipedia.org/wiki/DRY">principio DRY</a>
siempre deseable en todo desarrollo de software.</p>
<p>Una forma sencilla, pero a la vez parcial de resolver esto, es hacer un
<a class="reference external" href="http://es.wikipedia.org/wiki/enlace_duro">enlace duro</a> entre los
esqueletos que son iguales.</p>
<p>Por ejemplo, la sección 2, la 4 y la 6, tendrán el mismo esqueleto.
Entonces creamos el rubrique-2.html y definimos rubrique-4.html y
rubrique-6.html como enlaces duros al primero. Desde la línea de
comandos:</p>
<pre class="literal-block">
$ ln rubrique-2.html rubrique-4.html
$ ln rubrique-2.html rubrique-6.html
</pre>
<p>Esta solución funciona, pero es sólo para servidores <em>*nix</em> y teniendo
acceso a la consola (por <a class="reference external" href="http://es.wikipedia.org/wiki/SSH">SSH</a>, por
ejemplo). Además, hay que documentar bien qué se está haciendo, porque
da lugar a errores cuando dos esqueletos "linkeados" intentan ser
iguales.</p>
<p>Por suerte, hay varias otras maneras de resolver esto,</p>
<div class="section" id="filtros-de-condicion-o-filtro-match">
<h2>Filtros de condición o filtro match</h2>
<p><a class="reference external" href="http://archives.rezo.net/spip-es.mbox/200903.mbox/%3C516299.21618.qm@web90607.mail.mud.yahoo.com%3E">Esta
solución</a>,
es la que aportó <a class="reference external" href="http://www.graciasdenada.com.ar/">Juan Pablo
Portugau</a>.</p>
<p>Lo que plantea, es usar la baliza #ID_RUBRIQUE (que obviamente,
devuelve el número de la sección) con filtros de comparación. Es,
hablando en geek, un simple <strong>if</strong>: <em>Si es la sección 2, mostrar el
logo. Sino, nada</em>:</p>
<p>En código SPIP:</p>
<pre class="literal-block">
[(#ID_RUBRIQUE|=={2}|?{'#LOGO_RUBRIQUE',''})]
</pre>
<p>La limitación de esta solución se da cuando son múltiples los valores
posibles. En nuestro caso, se debe mostrar el logo cuando se trata de la
sección 2, de la 4 o de la 6. Juan Pablo propone anidar esta estructura.</p>
<pre class="literal-block">
[(#ID_RUBRIQUE|=={2}|?{'#LOGO_RUBRIQUE',[(#ID_RUBRIQUE|=={4}|?{'#LOGO_RUBRIQUE',[(#ID_RUBRIQUE|=={6}|?{'#LOGO_RUBRIQUE',''})]})]})]
</pre>
<p>Aunque es sintácticamente correcto, el código resultante es bastante
inmantenible para un ser humano con cerebro normal y el monito parseador
de SPIP queda agitado.</p>
<p>Para eso existe el filtro
<a class="reference external" href="http://www.spip.net/fr_article901.html#match">match</a>, que se vale de
las <a class="reference external" href="http://www.regular-expressions.info/">expresiones regulares</a> para
que hagamos nuestro festín.</p>
<p>Lo de arriba, puede reducirse a esto:</p>
<pre class="literal-block">
[(#ID_RUBRIQUE|match{^(2|4|6)$}|?{'#LOGO_RUBRIQUE',''})]
</pre>
<p>El filtro devuelve <strong>VERDADERO</strong> si el valor de #ID_RUBRIQUE empieza
con 2, 4 o 6 y termina con nada. Que es, dicho de otra manera, lo que
queremos.</p>
</div>
<div class="section" id="y-aun-mas-claro-bucles-como-filtros">
<h2>Y aún más claro: bucles como filtros</h2>
<p>Las expresiones regulares <em>no son moco de pavo</em>, diría mi abuela. Super
potentes, pero poco escalables en la curva complejidad-comprensibilidad.</p>
<p>Hay una solución que es muy útil, sencilla pero no trivial: usar un
bucle como filtro.</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 100)</p>
Literal block expected; none found.</div>
<p>La explicación es de la lógica de conjuntos: los criterios de un bucle
funcionan como condiciones AND. Deben cumplirse todas. En este caso, el
primer criterio <tt class="docutils literal">{id_rubrique IN (1,2,4)}</tt> exige que el id_rubrique
sea 1, 2 o 4. En el segundo <tt class="docutils literal">{id_rubrique}</tt>, se exige que sea el que
viene en contexto. Por lo tanto, este bucle sólo funcionará (mostrará el
logo) si el id_rubrique <em>del contexto</em> es 1, 2 o 4. En lógica, es una
operación <a class="reference external" href="http://es.wikipedia.org/wiki/Disyunci%C3%B3n_l%C3%B3gica">O
exclusiva</a></p>
<p>Funciona, es más legible que cualquiera de las otras soluciones y además
permite una clausula <em>ELSE</em> mucho más accesible, simplemente usando la
estructura completa del bucle.</p>
</div>
        <p>
        
            <a href="posts/variar-o-no-variar-esa-es-la.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/una-mejor-manera-de-controlar-los.html">Una mejor manera de controlar los atributos en SPIP</a>
        <small>  
             <span class="timeago" title="2009-03-12 06:29:35">2009-03-12 06:29:35</span>
        </small></h1>
        <p>Muchas balizas SPIP generan código HTML como salida (las balizas
#LOGO_* y los filtros |image_* son los más notorios) y
frecuentemente necesitamos o queremos modificar este código autogenerado
en nuestros esqueletos. Hay diversos filtros para ayudarnos a esto
(<a class="reference external" href="http://www.spip.net/en_article2465.html#inserer_attribut">inserer_attribut</a>
para insertar atributos y
<a class="reference external" href="http://www.spip.net/en_article2465.html#extraire_attribut">extraire_attribut</a>
para extraer el valor de uno generado) pero son particularmente largos y
tediosos de tipear.</p>
<p>Más allá de eso, aunque uso estos filtros bastantes seguido para
implementar cosas como galerías de imágenes, todavía pienso lo difícil
que es escribir las palabras en francés sin equivocarme. Por suerte, un
pequeño wrapper, puede suavizar este inconveniente.</p>
<p>Cuando se trata de acceder y modificar atributos de valores de atributos
nada, en mi opinión, llega tan lejos como <a class="reference external" href="http://docs.jquery.com/Attributes">la API de atributos de
jQuery</a>. El <a class="reference external" href="http://docs.jquery.com/Attributes/attr">método de jQuery
*attr*</a> por sí solo, permite
leer y escribir el valor de cualquier atributo en cualquier nodo. Recibe
uno o dos parámetros, el nombre del atributo, y opcionalmente, el valor.</p>
<p>Si sólo se especifica el nombre, entonces <em>attr</em> extrae y devuelve el
valor de ese atributo. Si ambos parámetros son pasados al método,
entonces attr modifica el objeto configurando el atributo en cuestión
con el valor dado. Es jerga de Programación Orientada a Objetos, es un
estilo de interfaz "polimórfica" — cuando un solo método tiene dos
comportamientos complementarios que son distinguidos por el número y/o
el tipo de los argumentos dados — que está por todos lados en jQuery y
es una de las razones por las que este framework es tan conciso y
productivo.</p>
<p>Considerandola como la mejor estructura para este tipo de interfaces que
conozco (y también, que uso diariamente), decidí ue mi wrapper tendría
que copiarlo. Así fue como el <em>attr</em> nació.</p>
<p>Como el método de jQuery, el filtro <em>attr</em> de SPIP toma uno o dos
parámetros (y un objeto "implícito", pero lo ignoraremos por el
momento). Si sólo pasamos uno, este lo remite como entrada a
<em>extraire_attribut</em> para obtener el valor correspondiente. Si se lo
llama con dos parámetros, entonces llama a <em>inserer_attribut</em> para
modificar el objeto.</p>
<p>Como la idea, el código es razonablemente sencillo; la únca</p>
<p>Like the idea, the code is reasonably straightforward; quizas lo único
un poco inusual el uso de
<a class="reference external" href="http://php.net/func_get_args">func_get_args</a> para obtener el
conjunto de los argumentos pasados a la función llamada. Con ese array
podermos usar <a class="reference external" href="http://php.net/count">count</a> para saber cuantos
argumentos se pasaron y decidir qué se debe hacer. Esto es más seguro
que especificar y evaluar valores por defecto (FALSE o NULL, por
ejemplo) porque algunos usuarios genuinamente podrían querer usar esos
valores (supongamos que NULL signifique eliminar el atributo en una
futura versión).</p>
<pre class="literal-block">
include_spip("inc/filtres");

/**
 * The `attr` function allows the user to get and set the attributes of an HTML tag.
 * It is intended to be used as a SPIP filter and depends on existing SPIP functionality.
 *
 * @param $tag
 *     The HTML code.
 * @param $name
 *     The name of the attribute.
 * @param $val...
 *     The new value for the attribute $nom. Optional.
 * @return
 *     If $val was given, the code for tag with $name=$val
 *     Otherwise, the value for the $name attribute in $tag.
 */
function attr($tag, $name){
        $args = func_get_args();

        if (count($args) &gt; 2) {
                // SET
                return  inserer_attribut($tag, $name, $args[2]);
        } else {
                // GET
                return extraire_attribut($tag, $name);
        }
}
</pre>
<p>Simplemente copia el código en mes_fonctions.php (Mira "Agregar
funciones propias" en la documentación sobre <a class="reference external" href="posts/Agregar%20funciones%20propias">filtros de
spip</a>) y luego usa el filtro attr en
tus esqueletos:</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 94)</p>
Literal block expected; none found.</div>
<p>Hay algunos cambios que se puede hacer a esta función: pasar $args
directamente a inserer_attribut y extraire_attribut en vez de las
variables individuales, agregar un parámetro $value=FALSE que sólo sirva
para la claridad de la documentación , y el mencionado, eliminar
atributos cuando se pase por ejemplo NULL como parámetro.</p>
        <p>
        
            <a href="posts/una-mejor-manera-de-controlar-los.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/personalizar-el-texto-de.html">Personalizar el texto de #INTRODUCTION</a>
        <small>  
             <span class="timeago" title="2009-03-10 10:38:44">2009-03-10 10:38:44</span>
        </small></h1>
        <p>Desde la versión 1.4, SPIP tiene una baliza calculada <tt class="docutils literal">#INTRODUCTION</tt>
que como su nombre indica, sirve para presentar una introducción al
artículo completo.</p>
<p>En la <a class="reference external" href="http://www.spip.net/es_article116.html">documentación explica</a></p>
<blockquote>
#INTRODUCTION: [SPIP 1.4] si el artículo contiene una descripción,
esta se utiliza aquí; si no, SPIP muestra los 600 primeros
caracteres del inicio del artículo (del epígrafe, y luego del
texto).</blockquote>
<p>En la versión 1.92 se incorporó otro atajo para indicar el largo del
texto mostrado (sobrecargando los 600 caracteres por omisión).</p>
<p>Así, <a href="posts/personalizar-el-texto-de.html#id1"><span class="problematic" id="id2">``</span></a>#INTRODUCTION{150} `` mostrará la descripción, si existe, o los
primeros 150 caracteres del epigrafe y/o el texto.</p>
<div class="system-message" id="id1">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 15); <em><a href="posts/personalizar-el-texto-de.html#id2">backlink</a></em></p>
Inline literal start-string without end-string.</div>
<p>Pero con la versión 2 llegó por fin un control más profundo para los
redactores. Es posible definir cual es el texto que se mostrará con
#INTRODUCTION encerrandolo entre la etiquetas <tt class="docutils literal"><span class="pre">&lt;intro&gt;...&lt;/intro&gt;</span></tt> en
el cuerpo del artículo.
[<a class="reference external" href="blog/article/personalizar-el-texto-de#nb1">1</a>]</p>
<p>Así podemos redactar nuestro artículo con la siguiente estructura:</p>
<pre class="literal-block">
Esta oración es la introducción al articulo. Y acá sigue mi artículo completo.
</pre>
<p>Suponiendo que la baliza #INTRODUCTION se muestra en el esqueleto de
seccion, allí se vería el texto</p>
<blockquote>
Esta oración es la introducción al articulo.</blockquote>
<p>Y donde esté la baliza #TEXTE:</p>
<blockquote>
Esta oración es la introducción al articulo. Y acá sigue mi artículo
completo.</blockquote>
        <p>
        
            <a href="posts/personalizar-el-texto-de.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/una-introduccion-a-python.html">Una introducción a Python</a>
        <small>  
             <span class="timeago" title="2009-03-09 21:56:54">2009-03-09 21:56:54</span>
        </small></h1>
        <p><a class="reference external" href="http://python.org/">Python</a> es un lenguaje de programación
interpretado, interactivo y multiplataforma, que con su facilidad y
potencia hace las delicias de miles de programadores (y sin saberlo,
también de los usuarios de los programas que estos desarrollan)
alrededor del mundo.</p>
<p>La comunidad de <a class="reference external" href="http://www.python.com.ar">Python Argentina</a> es
particularmente activa, solidaria y muy capaz técnicamente.</p>
<p>Esta charla fue dada por <a class="reference external" href="http://www.taniquetil.com.ar/plog/">Facundo
Batista</a>, uno de los fundadores de
PyAr, en las <a class="reference external" href="http://jornadas.grulic.org.ar/7/">7mas Jornada Regionales de Software
Libre</a> realizadas en Córdoba,
Argentina, en 2007.</p>
<p>Aquí la presentación</p>
        <p>
        
            <a href="posts/una-introduccion-a-python.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/c-automatico.html">© automático</a>
        <small>  
             <span class="timeago" title="2009-03-07 17:28:08">2009-03-07 17:28:08</span>
        </small></h1>
        <p>Más por costumbre que utilidad solemos poner la antigüedad de un sitio
web al pie de página, asociado al símbolo ©, o (cc) si usamos <a class="reference external" href="http://es.wikipedia.org/wiki/Creative_Commons">Creative
Commons</a>.</p>
<p>En el 2007 hicimos el sitio, y en este 2009 todavía muestra.</p>
<blockquote>
© 2007</blockquote>
<p>¡Muy feo! Aunque no hayamos actualizado el sitio desde entonces, nuestro
deber, como buenos mentirosos, es lograr que el visitante no se entere.</p>
<p>Así que podemos hacer que el año, o el período <strong>Año inicio - Año
actual</strong> se actualice automáticamente.</p>
<p>Muy simple:</p>
<pre class="literal-block">
© &lt;BOUCLE_yearbegin(ARTICLES){par date}{0,1}&gt;
    #SET{year, #DATE|annee} #GET{year}
  &lt;/BOUCLE_yearbegin&gt;
[(#GET{year}|=={#DATE|annee}|?{'' , - #DATE|annee} )]
</pre>
<div class="section" id="explicacion">
<h2>Explicación</h2>
<ul class="simple"><li>Por convención, asumimos que el año de inicio del sitio es el año del
primer artículo publicado, lo cual a mi me suena bastante lógico.</li>
<li>Un bucle recupera esta información, la muestra y a la vez la
guarda en una variable spip <tt class="docutils literal">#SET{year, #DATE|annee}</tt>.</li>
<li>Fuera del bucle comparamos el año ya mostrado con el actual,
obtenida de la baliza <tt class="docutils literal">#DATE</tt> sin contexto. Si son iguales,
no se muestra nada más (para que no quede algo como
<strong>© 2009 - 2009</strong>, que quedaría bien feo).
Pero si son distintos, se muestra el año actual</li>
</ul><p>El resultado, será:</p>
<blockquote>
© 2007 - 2009</blockquote>
<p>Y si la lógica o el reloj del servidor no fallan, en cada año nuevo se
incrementará el año final del período sin que toquemos una línea de código.</p>
</div>
        <p>
        
            <a href="posts/c-automatico.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/suscribirse-a-los-comentarios-por.html">Suscribirse a los comentarios por RSS</a>
        <small>  
             <span class="timeago" title="2009-02-27 21:04:48">2009-02-27 21:04:48</span>
        </small></h1>
        <p>Con SPIP 2.0, más precisamente en la revisión
<a class="reference external" href="http://trac.rezo.net/trac/spip/browser/spip/squelettes-dist/rss_forum_article.html?rev=13407">13407</a>
se agregaron algunos esqueletos al juego de esqueletos estándar.</p>
<p>Unos muy interesantes son los que permiten suscribirse a los
comentarios.</p>
<pre class="literal-block">
squelettes-dist/rss_forum_article.html
squelettes-dist/rss_forum_breve.html
squelettes-dist/rss_forum_rubrique.html
squelettes-dist/rss_forum_syndic.html
squelettes-dist/rss_forum_thread.html
</pre>
<p>Por ejemplo, en el foro de un articulo, podriamos incluir el siguiente
código, antes del bucle de comentarios de un artículo:</p>
<pre class="literal-block">
[] Suscribite a los comentarios de este artículo
</pre>
<p>Un código análogo, llamando al esqueleto correspondiente y pasando el
parámetro correcto, sirve para las breves, las secciones, los artículos
sindicados y los hilos de discusión (en foros con comentarios anidados).</p>
        <p>
        
            <a href="posts/suscribirse-a-los-comentarios-por.html#disqus_thread">Comments</a>
        
        </p></div>
    
        <div class="postbox">
        <h1><a href="posts/mostrar-u-ocultar-contenido-facil.html">Mostrar u ocultar contenido, fácil</a>
        <small>  
             <span class="timeago" title="2009-02-26 06:12:34">2009-02-26 06:12:34</span>
        </small></h1>
        <p>Adrian León consultó en la lista
<a class="reference external" href="http://listes.rezo.net/mailman/listinfo/spip-es">spip-es</a>:</p>
<blockquote>
<p>Estoy intentado poner balizas de este tipo:</p>
<p>#BOUTON_BLOCK</p>
<p>#DEBUT_BLOCK</p>
<p>Desde el editor del sitio privado en el texto de un artículo. No
conozco la forma de que funcione desde ahí (sale escrito como texto
en la página resultante. ¿Hay alguna manera de hacerlo?</p>
</blockquote>
<p>Estaba intentando, me enteré después, usar <a class="reference external" href="http://www.spip-contrib.net/Block-deplier-replier">este
plugin</a></p>
<p>Al otro día yo contesté:</p>
<blockquote>
<p>Hola Adrián. Desconocía de qué hablabas hasta que Marina mandó el
link. Me parece que en el algunas ocasiones los plugins están
opacando las soluciones más eficientes e ingeniosas, esas que
buscabamos antes de que todo fuese "enchufable". <strong>¡Spip se está
wordpressisando!</strong></p>
<p>Lo que quiero decir es que me parece que hay formas mejores de hacer
eso. Yo tengo <a class="reference external" href="http://www.lavozdelanzarote.com/Carlos-Espino-cree-que-los">un ejemplo para
darte</a></p>
<p>Andá al pie del artículo, y hacé click en Opinar: despliega (u
oculta, depende del estado) el formulario de comentarios.</p>
<p>Es, sin balizas ni plugins, lo que parece que hace esa contrib.</p>
</blockquote>
<p>Y el código es de risa: un pelín de jQuery (con su efecto
<a class="reference external" href="http://docs.jquery.com/Effects/toggle">toggle()</a> )</p>
<p>El <a class="reference external" href="http://www.lavozdelanzarote.com/squelettes/inc_article.html">esqueleto del ejemplo que
propongo</a>
es bien sencillo. El formulario aparece encerrado en una <tt class="docutils literal">div</tt> y
escondido con la propiedad CSS <tt class="docutils literal">display:none</tt>. De manera simplificada
[<a class="reference external" href="blog/article/mostrar-u-ocultar-contenido-facil#nb1">1</a>] :</p>
<pre class="literal-block">
[(#FORMULAIRE_FORUM)]
</pre>
<p>Y el link que produce el efecto mostrar/ocultar (en este caso «opinar»
)tiene este código.</p>
<pre class="literal-block">
Opinar
</pre>
<p>En perfecto argentino se diría: ¡una papa!</p>
<p>Breve explicación: Al hacer click sobre el link, se ejecuta el evento
Onclick, que mendiante jQuery (que ya se encuentra en todo sitio SPIP si
existe la baliza #INSERT_HEAD en el <tt class="docutils literal">&lt;head&gt;</tt> de los esqueletos), se
busca la el bloque con ID «form-comment» (o sea, el <tt class="docutils literal">div</tt> contenedor
del formulario), y se aplica <tt class="docutils literal">toggle()</tt>, que es una funcion que si el
bloque está oculto, lo muestra, y se está visible lo oculta. Simple y
efectivo.</p>
<div class="section" id="permitiendo-el-uso-desde-la-redaccion">
<h2>Permitiendo el uso desde la redacción</h2>
<p>Hasta aquí el reemplazo al plugin, que no da una solución completa a la
consulta de Adrían, porque esta solución también está programado en los
esqueletos del sitio. Pero, con simples modificaciones, se puede usar
dentro del texto de los artículos.</p>
<p>El truco es este: la balizas no se pueden usar en el texto, pero <strong>los
modelos</strong> sí. Y como spip respeta el HTML, tenemos solución: generamo el
link interruptor a través de <a class="reference external" href="http://www.spip.net/es_article3609.html">un
modelo</a>
[<a class="reference external" href="blog/article/mostrar-u-ocultar-contenido-facil#nb2">2</a>].</p>
<p>Creamos un modelo dentro de <em>modeles/toggle.html</em> (dentro de la carpeta
de nuestros esqueletos) con el siguiente código:</p>
<pre class="literal-block">
#ENV{texto}
</pre>
<p>¡Y listo!</p>
<p>Para usarlo, en el cuerpo del artículo se invocaría al modelo con dos
parámetros: el identificador del contenedor, y el texto de link
controlador.</p>
<p>Donde se quiera mostrar el link escribimos:</p>
<div class="system-message">
<p class="system-message-title">System Message: WARNING/2 (<tt class="docutils">&lt;string&gt;</tt>, line 95)</p>
Literal block expected; none found.</div>
<p>y donde queramos que vaya el contenido oculto:</p>
<pre class="literal-block">
Hola amigos, esto es una astucia para el compañero Adrian!
&lt;/div&gt;
</pre>
<p>Sólo hay que asegurarse de que el ID del contenedor sea el mismo que el
parametro <em>div</em> que pasamos a nuestro modelo. Por supuesto, esto permite
tener múltiples bloques ocultos y link controladores.</p>
</div>
<div class="section" id="el-resultado">
<h2>El resultado</h2>
<p><a class="reference external" href="blog/article/mostrar-u-ocultar-contenido-facil#oculto">esto
funciona?</a></p>
<p>¡Hola amigos, esto es una astucia para el compañero Adrian!</p>
</div>
        <p>
        
            <a href="posts/mostrar-u-ocultar-contenido-facil.html#disqus_thread">Comments</a>
        
        </p></div>
    
    <div>
<ul class="pager"><li class="previous">
        <a href="index-5.html">← Posts posteriores</a>
    </li>
  
  
    <li class="next">
        <a href="index-7.html">Posts anteriores  →</a>
    </li>
  
</ul></div>
    
        <script type="text/javascript"> var disqus_shortname = 'nqnwebs'; (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = 'http://' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script><!--End of body content--><hr><small>Contents © 2012 Martín Gaitán</small>
        </div>
    </div>
    <div class="row">
        <div class="span10 offset1" id="sidebar">
            <!--Sidebar content-->
            <ul class="inline"><li><a href="http://www.textosypretextos.com.ar" title="Mi otro blog">Textos y pretextos</a>
                    /
                </li><li><a href="http://nikola.ralsina.com.ar">Powered by Nikola</a>
                /
            </li><li> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
                        <img alt="Licencia Creative Commons" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/2.5/ar/80x15.png"></a>
            </li></ul><!--End of sidebar content--></div>
    
    
    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script></div></div></div></div></body></html>